<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšç‰©é¦†æ™ºæ…§ç®¡ç†ç³»ç»Ÿ - æ–‡ç‰©ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover,
        .nav-btn.active {
            background: rgba(255,255,255,0.3);
            border-color: white;
            transform: translateY(-2px);
        }

        .content-area {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(20px);
            min-height: 600px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table th,\n        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 500;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .qr-scanner {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
        }

        .qr-scanner:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .device-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-online {
            background: #d4edda;
            color: #155724;
        }

        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .main-nav {
                gap: 10px;
            }

            .nav-btn {
                padding: 8px 16px;
                font-size: 14px;
            }

            .content-area {
                padding: 20px;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- èº«ä»½é€‰æ‹©ç•Œé¢ -->
    <div id="roleSelectionArea" style="text-align: center; padding-top: 100px;">
        <h1>è¯·é€‰æ‹©æ‚¨çš„èº«ä»½</h1>
        <div style="margin-top: 30px;">
            <button class="btn btn-secondary" onclick="selectRole('Normal')">æ™®é€šç”¨æˆ·</button>
            <button class="btn btn-secondary" onclick="selectRole('Admin')">ç®¡ç†å‘˜</button>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ ( initially hidden ) -->
    <div id="mainContentArea" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>ğŸ›ï¸ åšç‰©é¦†æ™ºæ…§ç®¡ç†ç³»ç»Ÿ</h1>
                <p>Museum Smart Management System - MVPç‰ˆæœ¬</p>
                <!-- æ·»åŠ å›æ˜¾ç¤ºå½“å‰è§’è‰²çš„ span -->
                <span id="currentRoleDisplay" style="margin-left: 20px; color: #333;">å½“å‰è§’è‰²: æœªè®¾ç½®</span>
                <!-- æ–°å¢ï¼šé‡æ–°é€‰æ‹©èº«ä»½æŒ‰é’® -->
                 <button class="btn btn-secondary btn-sm" onclick="resetRoleSelection()" style="margin-left: 20px;">é‡æ–°é€‰æ‹©èº«ä»½</button>
            </div>

            <!-- åŸæœ‰çš„æ¨¡æ‹Ÿç”¨æˆ·èº«ä»½æ§åˆ¶åŒºåŸŸå·²ç»è½¬ç§»åˆ°èº«ä»½é€‰æ‹©ç•Œé¢ -->
            <!-- <div style="text-align: center; margin-bottom: 20px;"> ... </div> -->

            <div class="main-nav">
                <button class="nav-btn active" data-target="overview">é¦–é¡µæ¦‚è§ˆ</button>
                <!-- è§‚ä¼—ç«¯å¯¼èˆªæŒ‰é’®ï¼Œæ ¹æ®å®é™…æƒ…å†µæ·»åŠ æˆ–ä¿®æ”¹ -->
                <button class="nav-btn" data-target="artifact-info">æ–‡ç‰©ä¿¡æ¯</button>
                <button class="nav-btn" data-target="multimedia-interaction">å¤šåª’ä½“äº’åŠ¨</button>
                <button class="nav-btn" data-target="community">äº’åŠ¨ç¤¾åŒº</button>
                <button class="nav-btn" data-target="ai-qa">AIé—®ç­”</button>
                <!-- ç®¡ç†ç«¯å¯¼èˆªæŒ‰é’® -->
                <button class="nav-btn" data-target="artifact-management">æ–‡ç‰©ç®¡ç†</button>
                <button class="nav-btn" data-target="device-management">è®¾å¤‡ç®¡ç†</button>
                <button class="nav-btn" data-target="activity-management">æ´»åŠ¨ç®¡ç†</button>
                <button class="nav-btn" data-target="exhibition-hall-management">å±•å…ç®¡ç†</button>
                <button class="nav-btn" data-target="user-management">ç”¨æˆ·ç®¡ç†</button>
                <button class="nav-btn" data-target="data-dashboard">æ•°æ®çœ‹æ¿</button>
            </div>

            <div class="content-area">
                 <!-- é¦–é¡µæ¦‚è§ˆ Section (ç¤ºä¾‹) -->
                 <section id="overview" class="section active">
                     <h2>ğŸ“Š æ•°æ®æ€»è§ˆ</h2>
                     <div class="stats-grid">
                         <div class="stat-card">
                             <h3 id="totalArtifacts">0</h3>
                             <p>æ–‡ç‰©æ€»æ•°</p>
                         </div>
                         <div class="stat-card">
                             <h3 id="onlineDevices">0</h3>
                             <p>åœ¨çº¿è®¾å¤‡</p>
                         </div>
                         <div class="stat-card">
                             <h3 id="todayVisitors">0</h3>
                             <p>ä»Šæ—¥è®¿å®¢</p>
                         </div>
                         <div class="stat-card">
                             <h3 id="activeEvents">0</h3>
                             <p>è¿›è¡Œä¸­æ´»åŠ¨</p>
                         </div>
                     </div>

                     <div class="card-grid">
                         <div class="card">
                             <h3>ğŸº çƒ­é—¨æ–‡ç‰©</h3>
                             <table class="data-table">
                                 <thead>
                                     <tr>
                                         <th>æ–‡ç‰©åç§°</th>
                                         <th>æµè§ˆæ¬¡æ•°</th>
                                     </tr>
                                 </thead>
                                 <tbody id="popularArtifactsTableBody">
                                     <!-- åŠ¨æ€åŠ è½½å†…å®¹ -->
                                     <tr><td>åŠ è½½ä¸­...</td><td></td></tr>
                                 </tbody>
                             </table>
                         </div>
                         <div class="card">
                             <h3>âš ï¸ è®¾å¤‡å‘Šè­¦</h3>
                             <div id="deviceAlerts">
                                  <!-- åŠ¨æ€åŠ è½½å†…å®¹ -->
                                  <p style="color: #28a745;">âœ… æ‰€æœ‰è®¾å¤‡è¿è¡Œæ­£å¸¸</p> <!-- Default static message -->
                             </div>
                         </div>
                         <!-- æ–°å¢ï¼šæœ€æ–°æ´»åŠ¨å¡ç‰‡ -->
                         <div class="card">
                              <h3>âœ¨ æœ€æ–°æ´»åŠ¨</h3>
                              <div id="latestActivitiesList">
                                  <!-- æœ€æ–°æ´»åŠ¨åˆ—è¡¨å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                                  <p>åŠ è½½ä¸­...</p>
                              </div>
                         </div>
                     </div>

                     <div class="qr-scanner">
                         <h3>ğŸ“¸ æ‰«æäºŒç»´ç </h3>
                         <p>è¯·ä½¿ç”¨ç§»åŠ¨è®¾å¤‡æ‰«æäºŒç»´ç è¿›è¡Œè®¿é—®ã€‚</p>
                         <!-- äºŒç»´ç æ˜¾ç¤ºåŒºåŸŸ -->
                         <div id="qrcode" style="margin: 20px auto; width: 150px; height: 150px;"></div>
                         <button class="btn btn-secondary" onclick="simulateQRScan()">æ¨¡æ‹Ÿæ‰«æ</button>
                     </div>
                 </section>

                 <!-- è§‚ä¼—ç«¯ Sections (ç¤ºä¾‹) -->
                 <section id="artifact-info" class="section">
                     <h2>æ–‡ç‰©ä¿¡æ¯ä¸å¯¼è§ˆ</h2>
                     <p>æµè§ˆæˆ‘ä»¬çš„æ–‡ç‰©æ”¶è—ã€‚</p>
                     <!-- æ–‡ç‰©å±•ç¤ºåŒºåŸŸ -->
                      <div class="artifact-list-audience" id="audienceArtifactList">
                         <!-- æ–‡ç‰©å¡ç‰‡æˆ–åˆ—è¡¨å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                          <p>åŠ è½½ä¸­...</p> <!-- åˆå§‹åŠ è½½æç¤º -->
                     </div>
                     <!-- æ–‡ç‰©è¯¦æƒ…å±•ç¤ºåŒºåŸŸ (åˆå§‹éšè—) -->
                      <section id="artifact-details" class="section" style="display: none;">
                         <!-- å•ä¸ªæ–‡ç‰©è¯¦æƒ…å°†ç”±JavaScriptåŠ è½½åˆ°è¿™é‡Œ -->
                      </section>
                 </section>

                 <section id="multimedia-interaction" class="section">
                     <h2>å¤šåª’ä½“äº’åŠ¨</h2>
                     <p>æ¢ç´¢ä¸°å¯Œçš„å¤šåª’ä½“å†…å®¹ï¼ŒåŒ…æ‹¬æ–‡ç‰©éŸ³è§†é¢‘å’Œå±•å…å…¨æ™¯ã€‚</p>

                     <!-- å…¨æ™¯å±•å…åŒºåŸŸ -->
                      <div class="card" style="margin-bottom: 20px;">
                         <h3>ğŸŒ å±•å…å…¨æ™¯</h3>
                          <div id="panoramaView">
                              <p>åŠ è½½ä¸­...</p>
                              <!-- å…¨æ™¯è§†å›¾å°†åŠ è½½åˆ°è¿™é‡Œ -->
                         </div>
                     </div>

                     <!-- å¸¦æœ‰åª’ä½“çš„æ–‡ç‰©åˆ—è¡¨åŒºåŸŸ -->
                     <div class="card">
                         <h3>â–¶ï¸ åª’ä½“æ–‡ç‰©åˆ—è¡¨</h3>
                          <div id="multimediaArtifactList">
                              <!-- å¸¦æœ‰éŸ³é¢‘æˆ–è§†é¢‘çš„æ–‡ç‰©åˆ—è¡¨å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                              <p>åŠ è½½ä¸­...</p>
                         </div>
                     </div>
                 </section>

                 <section id="community" class="section">
                     <h2>äº’åŠ¨ç¤¾åŒº</h2>
                     <p>åœ¨è¿™é‡Œåˆ†äº«æ‚¨çš„å‚è§‚ä½“éªŒå’Œå¿ƒå¾—ã€‚</p>

                     <!-- åˆ†äº«å¿ƒå¾—è¡¨å•åŒºåŸŸ -->
                      <div class="card" style="margin-bottom: 20px;">
                         <h3>âœï¸ åˆ†äº«æˆ‘çš„å¿ƒå¾—</h3>
                          <form id="shareExperienceForm">
                             <div class="form-group">
                                  <label for="experienceContent">æˆ‘çš„å¿ƒå¾—:</label>
                                 <textarea id="experienceContent" rows="4" required placeholder="å†™ä¸‹æ‚¨çš„å‚è§‚æ„Ÿå—..."></textarea>
                              </div>
                              <!-- å¯é€‰ï¼šå…³è”æ–‡ç‰© -->
                              <div class="form-group">
                                  <label for="experienceArtifact">å…³è”æ–‡ç‰© (å¯é€‰):</label>
                                  <select id="experienceArtifact">
                                      <option value="">-- é€‰æ‹©æ–‡ç‰© --</option>
                                      <!-- æ–‡ç‰©åˆ—è¡¨å°†ç”±JavaScriptå¡«å…… -->
                                 </select>
                              </div>
                              <!-- TODO: å¦‚æœæœ‰ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Œè¿™é‡Œéœ€è¦ä¼ é€’ç”¨æˆ·ID -->
                              <button type="submit" class="btn">æäº¤å¿ƒå¾—</button>
                          </form>
                     </div>

                     <!-- ç”¨æˆ·å¿ƒå¾—åˆ—è¡¨åŒºåŸŸ -->
                      <div class="card">
                         <h3>ğŸ’¬ å¤§å®¶çš„å¿ƒå¾—</h3>
                          <div id="communityPostsList">
                              <!-- ç”¨æˆ·å¿ƒå¾—å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                              <p>åŠ è½½ä¸­...</p>
                          </div>
                     </div>
                 </section>

                 <section id="ai-qa" class="section">
                     <h2>AIé—®ç­”</h2>
                     <p>åœ¨æ­¤æ‚¨å¯ä»¥æäº¤é—®é¢˜ï¼Œæˆ–æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„å…¬å¼€é—®ç­”å’Œæ™ºèƒ½è§£ç­”ã€‚</p>

                     <!-- æé—®è¡¨å• -->
                      <div class="card" style="margin-bottom: 20px;">
                         <h3>æé—®</h3>
                          <form id="askQuestionForm">
                             <div class="form-group">
                                 <label for="questionText">æ‚¨çš„é—®é¢˜:</label>
                                 <textarea id="questionText" rows="4" required placeholder="è¯·è¾“å…¥æ‚¨å…³äºåšç‰©é¦†æˆ–æ–‡ç‰©çš„ç–‘é—®..."></textarea>
                             </div>
                              <!-- å¦‚æœé—®é¢˜æ˜¯é’ˆå¯¹ç‰¹å®šæ–‡ç‰©çš„ï¼Œå¯ä»¥é€‰æ‹©å…³è”æ–‡ç‰© -->
                              <div class="form-group">
                                  <label for="questionArtifact">å…³è”æ–‡ç‰© (å¯é€‰):</label>
                                  <select id="questionArtifact">
                                      <option value="">-- é€‰æ‹©æ–‡ç‰© --</option>
                                      <!-- æ–‡ç‰©åˆ—è¡¨å°†ç”±JavaScriptå¡«å…… -->
                                  </select>
                              </div>
                              <button type="submit" class="btn">æäº¤é—®é¢˜</button>
                          </form>
                     </div>

                      <!-- é—®ç­”åˆ—è¡¨åŒºåŸŸ -->
                      <div class="card">
                         <h3>å…¬å¼€é—®ç­”åˆ—è¡¨</h3>
                          <div id="qaList">
                              <!-- é—®ç­”æ•°æ®å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                              <p>åŠ è½½ä¸­...</p>
                         </div>
                     </div>
                 </section>

                 <!-- ç®¡ç†ç«¯ Sections -->
                 <section id="artifact-management" class="section">
                     <h2>æ–‡ç‰©ç®¡ç†</h2>
                     <p>æ­¤åŒºåŸŸç”¨äºæ–‡ç‰©çš„ä¿¡æ¯å½•å…¥ã€æ‰¹é‡å¯¼å…¥åŠå›¾åƒè¯†åˆ«è¾…åŠ©å»ºæ¡£ç­‰æ“ä½œã€‚</p>
                     <!-- TODO: åœ¨æ­¤æ·»åŠ æ–‡ç‰©ç®¡ç†çš„è¡¨å•ã€è¡¨æ ¼ç­‰å…·ä½“HTMLå…ƒç´  -->

                     <!-- æ–‡ç‰©æ·»åŠ /ç¼–è¾‘è¡¨å•åŒºåŸŸ -->
                     <div class="card" style="margin-bottom: 20px;">
                         <h3>ğŸ“ æ·»åŠ æ–°æ–‡ç‰©</h3>
                         <form id="addArtifactForm">
                             <div class="form-group">
                                 <label for="artifactName">åç§°:</label>
                                 <input type="text" id="artifactName" required placeholder="ä¾‹ï¼šå”ä¸‰å½©é©¬ä¿‘">
                             </div>
                             <div class="form-group">
                                 <label for="artifactCategory">åˆ†ç±»:</label>
                                 <input type="text" id="artifactCategory" placeholder="ä¾‹ï¼šé™¶ç“·">
                             </div>
                              <div class="form-group">
                                 <label for="artifactEra">å¹´ä»£:</label>
                                 <input type="text" id="artifactEra" placeholder="ä¾‹ï¼šå”ä»£">
                              </div>
                             <div class="form-group">
                                 <label for="artifactLocation">ä½ç½®:</label>
                                  <input type="text" id="artifactLocation" placeholder="ä¾‹ï¼šå¤ä»£æ–‡æ˜å…">
                             </div>
                             <div class="form-group">
                                 <label for="artifactDescription">æè¿°:</label>
                                 <textarea id="artifactDescription" rows="3" placeholder="è¯·è¾“å…¥æ–‡ç‰©è¯¦ç»†æè¿°..."></textarea>
                             </div>
                             <div class="form-group">
                                  <label for="artifactImageUrl">å›¾ç‰‡URL:</label>
                                  <input type="url" id="artifactImageUrl" placeholder="ä¾‹ï¼šhttp://example.com/img/artifact1.jpg">
                               </div>
                               <div class="form-group">
                                  <label for="artifactImageFile">æˆ–ä¸Šä¼ å›¾ç‰‡:</label>
                                  <input type="file" id="artifactImageFile" accept="image/*">
                               </div>
                             <div class="form-group">
                                 <label for="artifactAudioUrl">éŸ³é¢‘URL:</label>
                                 <input type="url" id="artifactAudioUrl" placeholder="ä¾‹ï¼šhttp://example.com/audio/artifact1.mp3">
                              </div>
                              <div class="form-group">
                                  <label for="artifactAudioFile">æˆ–ä¸Šä¼ éŸ³é¢‘:</label>
                                  <input type="file" id="artifactAudioFile" accept="audio/*">
                              </div>
                             <div class="form-group">
                                 <label for="artifactVideoUrl">è§†é¢‘URL:</label>
                                 <input type="url" id="artifactVideoUrl" placeholder="ä¾‹ï¼šhttp://example.com/video/artifact1.mp4">
                              </div>
                              <div class="form-group">
                                 <label for="artifactFeatureTags">ç‰¹å¾æ ‡ç­¾ (é€—å·åˆ†éš”):</label>
                                 <input type="text" id="artifactFeatureTags" placeholder="ä¾‹ï¼šé©¬, å”ä»£, é™¶ç“·">
                              </div>
                              <!-- å¯¹äºview_count, interact_count, is_hot, is_new, create_time, update_timeè¿™äº›å­—æ®µï¼Œ
                                   é€šå¸¸åœ¨åç«¯å¤„ç†æˆ–æœ‰é»˜è®¤å€¼ï¼Œå‰ç«¯å½•å…¥æ—¶å¯èƒ½ä¸éœ€è¦ï¼Œæˆ–è€…åªéœ€è¦is_hot, is_newçš„checkbox -->
                              <div class="form-group">
                                   <input type="checkbox" id="artifactIsHot"> <label for="artifactIsHot">çƒ­é—¨</label>
                              </div>
                              <div class="form-group">
                                   <input type="checkbox" id="artifactIsNew"> <label for="artifactIsNew">æ–°å…¥è—</label>
                              </div>


                             <button type="submit" class="btn">æ·»åŠ æ–‡ç‰©</button>
                         </form>
                     </div>

                     <!-- æ–‡ç‰©åˆ—è¡¨åŒºåŸŸ -->
                     <div class="card" style="margin-top: 20px;">
                         <h3>ğŸ“‹ æ–‡ç‰©åˆ—è¡¨</h3>
                         <table class="data-table" id="artifactsTable">
                             <thead>
                                 <tr>
                                     <th>ç¼–å·</th>
                                     <th>åç§°</th>
                                     <th>åˆ†ç±»</th>
                                     <th>å¹´ä»£</th>
                                     <th>ä½ç½®</th>
                                     <th>æµè§ˆæ¬¡æ•°</th>
                                     <th>çƒ­é—¨</th>
                                     <th>æ–°å…¥è—</th>
                                     <th>æ“ä½œ</th>
                                 </tr>
                             </thead>
                             <tbody id="artifactsTableBody">
                                 <!-- æ–‡ç‰©æ•°æ®å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                                 <tr><td colspan="9">åŠ è½½ä¸­...</td></tr> <!-- åˆå§‹åŠ è½½æç¤º -->
                             </tbody>
                         </table>
                     </div>

                 </section>

                 <section id="device-management" class="section">
                     <h2>ğŸ“¡ è®¾å¤‡ç›‘æ§</h2>
                     <p>æ­¤åŒºåŸŸç”¨äºè®¾å¤‡çš„å®æ—¶çŠ¶æ€ç›‘æ§ã€æ•°æ®å›¾è¡¨å±•ç¤ºåŠæ•…éšœé¢„è­¦é…ç½®ã€‚</p>
                     <!-- TODO: åœ¨æ­¤æ·»åŠ è®¾å¤‡çŠ¶æ€å±•ç¤ºã€å›¾è¡¨åŒºåŸŸç­‰å…·ä½“HTMLå…ƒç´  -->

                      <!-- ç¯å¢ƒç›‘æ§/äººæµç›‘æ§å¡ç‰‡ (ä¿ç•™æˆ–æ ¹æ®éœ€è¦ä¿®æ”¹) -->
                      <div class="card-grid" style="margin-bottom: 20px;">
                          <div class="card">
                              <h3>ğŸŒ¡ï¸ ç¯å¢ƒç›‘æ§</h3>
                              <div class="stats-grid">
                                  <div class="stat-card">
                                      <h3 id="temperature">--Â°C</h3>
                                      <p>æ¸©åº¦</p>
                                  </div>
                                  <div class="stat-card">
                                      <h3 id="humidity">--%</h3>
                                      <p>æ¹¿åº¦</p>
                                  </div>
                              </div>
                          </div>
                          <div class="card">
                              <h3>ğŸ‘¥ äººæµç›‘æ§</h3>
                              <div class="stats-grid">
                                  <div class="stat-card">
                                      <h3 id="currentVisitors">--</h3>
                                      <p>å½“å‰åœ¨é¦†äººæ•°</p>
                                  </div>
                                  <div class="stat-card">
                                      <h3 id="peakTime">--:--</h3>
                                      <p>ä»Šæ—¥é«˜å³°æ—¶æ®µ</p>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <!-- è®¾å¤‡çŠ¶æ€åˆ—è¡¨åŒºåŸŸ -->
                      <div class="card">
                         <h3>ğŸ”§ è®¾å¤‡çŠ¶æ€åˆ—è¡¨</h3>
                          <table class="data-table" id="devicesTable">
                             <thead>
                                 <tr>
                                     <th>ID</th>
                                     <th>è®¾å¤‡ID</th>
                                     <th>ç±»å‹</th>
                                     <th>ä½ç½®</th>
                                     <th>çŠ¶æ€</th>
                                     <th>å€¼</th>
                                      <th>ç”µé‡ (%)</th>
                                      <th>å‘Šè­¦çº§åˆ«</th>
                                     <th>å‘Šè­¦ä¿¡æ¯</th>
                                     <th>æ›´æ–°æ—¶é—´</th>
                                 </tr>
                             </thead>
                             <tbody id="devicesTableBody">
                                 <!-- è®¾å¤‡æ•°æ®å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                                 <tr><td colspan="10">åŠ è½½ä¸­...</td></tr> <!-- åˆå§‹åŠ è½½æç¤º -->
                             </tbody>
                         </table>
                     </div>

                 </section>

                 <section id="activity-management" class="section">
                     <h2>ğŸ‰ æ´»åŠ¨ç®¡ç†</h2>
                     <p>æ­¤åŒºåŸŸç”¨äºæ´»åŠ¨çš„ç­–åˆ’å‘å¸ƒã€ç”¨æˆ·æŠ¥åç®¡ç†åŠç”¨æˆ·ç”»åƒåˆ†æã€‚</p>
                     <!-- TODO: åœ¨æ­¤æ·»åŠ æ´»åŠ¨å‘å¸ƒè¡¨å•ã€æ´»åŠ¨åˆ—è¡¨ã€å‚ä¸è€…åˆ—è¡¨ç­‰å…·ä½“HTMLå…ƒç´  -->

                     <!-- æ´»åŠ¨æ·»åŠ /ç¼–è¾‘è¡¨å•åŒºåŸŸ -->
                     <div class="card" style="margin-bottom: 20px;">
                         <h3>ğŸ“ æ·»åŠ æ–°æ´»åŠ¨</h3>
                         <form id="addActivityForm">
                             <div class="form-group">
                                 <label for="activityTitle">æ ‡é¢˜:</label>
                                 <input type="text" id="activityTitle" required placeholder="ä¾‹ï¼šæ–‡ç‰©çŸ¥è¯†è®²åº§">
                             </div>
                             <div class="form-group">
                                 <label for="activityType">ç±»å‹:</label>
                                 <input type="text" id="activityType" placeholder="ä¾‹ï¼šworkshop/exhibition/talk">
                             </div>
                             <div class="form-group">
                                 <label for="activityStartTime">å¼€å§‹æ—¶é—´:</label>
                                 <input type="datetime-local" id="activityStartTime" required>
                             </div>
                             <div class="form-group">
                                 <label for="activityEndTime">ç»“æŸæ—¶é—´:</label>
                                 <input type="datetime-local" id="activityEndTime">
                             </div>
                             <div class="form-group">
                                 <label for="activityLocation">åœ°ç‚¹:</label>
                                 <input type="text" id="activityLocation" placeholder="ä¾‹ï¼šå¤šåŠŸèƒ½å…A">
                             </div>
                             <div class="form-group">
                                 <label for="activityDescription">æè¿°:</label>
                                 <textarea id="activityDescription" rows="3" placeholder="è¯·è¾“å…¥æ´»åŠ¨è¯¦ç»†æè¿°..."></textarea>
                             </div>
                             <div class="form-group">
                                 <label for="activityImageUrl">å›¾ç‰‡URL:</label>
                                 <input type="url" id="activityImageUrl" placeholder="ä¾‹ï¼šhttp://example.com/img/activity1.jpg">
                             </div>
                             <div class="form-group">
                                 <label for="activityImageFile">æˆ–ä¸Šä¼ å›¾ç‰‡:</label>
                                 <input type="file" id="activityImageFile" accept="image/*">
                             </div>
                             <div class="form-group">
                                 <label for="activityMaxParticipants">æœ€å¤§å‚ä¸äººæ•°:</label>
                                 <input type="number" id="activityMaxParticipants" placeholder="ä¾‹ï¼š100">
                             </div>
                             <div class="form-group">
                                  <input type="checkbox" id="activityIsPublished"> <label for="activityIsPublished">æ˜¯å¦å‘å¸ƒ</label>
                             </div>

                             <button type="submit" class="btn">æ·»åŠ æ´»åŠ¨</button>
                         </form>
                     </div>

                     <!-- æ´»åŠ¨åˆ—è¡¨åŒºåŸŸ -->
                     <div class="card">
                         <h3>ğŸ“… æ´»åŠ¨åˆ—è¡¨</h3>
                          <table class="data-table" id="activitiesTable">
                             <thead>
                                 <tr>
                                     <th>ID</th>
                                     <th>æ ‡é¢˜</th>
                                     <th>ç±»å‹</th>
                                     <th>å¼€å§‹æ—¶é—´</th>
                                     <th>ç»“æŸæ—¶é—´</th>
                                     <th>åœ°ç‚¹</th>
                                      <th>æœ€å¤§äººæ•°</th>
                                     <th>å½“å‰äººæ•°</th>
                                     <th>å·²å‘å¸ƒ</th>
                                     <th>æ“ä½œ</th>
                                 </tr>
                             </thead>
                             <tbody id="activitiesTableBody">
                                 <!-- æ´»åŠ¨æ•°æ®å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                                 <tr><td colspan="10">åŠ è½½ä¸­...</td></tr> <!-- åˆå§‹åŠ è½½æç¤º -->
                             </tbody>
                         </table>
                     </div>

                 </section>

                 <section id="data-dashboard" class="section">
                     <h2>æ•°æ®çœ‹æ¿</h2>
                     <p>æ­¤åŒºåŸŸç”¨äºå±•ç¤ºè§‚ä¼—è¡Œä¸ºæ•°æ®ç»Ÿè®¡ï¼Œå¦‚å¯¼è§ˆåœç•™æ—¶é•¿ã€äº’åŠ¨é¢‘ç‡ç­‰ã€‚</p>
                     <!-- TODO: åœ¨æ­¤æ·»åŠ æ•°æ®å›¾è¡¨ã€ç»Ÿè®¡è¡¨æ ¼ç­‰å…·ä½“HTMLå…ƒç´  -->

                      <!-- ç”¨æˆ·è¡Œä¸ºæ•°æ®åˆ—è¡¨åŒºåŸŸ -->
                      <div class="card" style="margin-top: 20px;">
                         <h3>ğŸ“Š ç”¨æˆ·è¡Œä¸ºè®°å½•</h3>
                          <table class="data-table" id="userBehaviorsTable">
                             <thead>
                                 <tr>
                                     <th>ID</th>
                                     <th>ç”¨æˆ·ID</th>
                                     <th>æ–‡ç‰©ID</th>
                                     <th>è¡Œä¸ºç±»å‹</th>
                                     <th>æ—¶é•¿ (ç§’)</th>
                                     <th>å†…å®¹</th>
                                     <th>ä½ç½®</th>
                                     <th>æ—¶é—´</th>
                                 </tr>
                             </thead>
                             <tbody id="userBehaviorsTableBody">
                                 <!-- ç”¨æˆ·è¡Œä¸ºæ•°æ®å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                                 <tr><td colspan="8">åŠ è½½ä¸­...</td></tr> <!-- åˆå§‹åŠ è½½æç¤º -->
                             </tbody>
                         </table>
                     </div>
                 </section>

                 <!-- ç®¡ç†ç«¯ Sections - å±•å…ç®¡ç† -->
                 <section id="exhibition-hall-management" class="section">
                     <h2>ğŸ›ï¸ å±•å…ç®¡ç†</h2>
                     <p>æ­¤åŒºåŸŸç”¨äºå±•å…ä¿¡æ¯çš„ç®¡ç†ï¼ŒåŒ…æ‹¬åç§°ã€æ¥¼å±‚ã€åŒºåŸŸç ç­‰ã€‚</p>

                     <!-- å±•å…æ·»åŠ /ç¼–è¾‘è¡¨å•åŒºåŸŸ -->
                     <div class="card" style="margin-bottom: 20px;">
                         <h3>ğŸ“ æ·»åŠ æ–°å±•å…</h3>
                         <form id="addExhibitionHallForm">
                             <div class="form-group">
                                 <label for="hallName">åç§°:</label>
                                 <input type="text" id="hallName" required placeholder="ä¾‹ï¼šå¤ä»£æ–‡æ˜å…">
                             </div>
                              <div class="form-group">
                                 <label for="hallFloor">æ¥¼å±‚:</label>
                                 <input type="text" id="hallFloor" placeholder="ä¾‹ï¼š1F">
                              </div>
                             <div class="form-group">
                                 <label for="hallAreaCode">åŒºåŸŸç :</label>
                                 <input type="text" id="hallAreaCode" placeholder="ä¾‹ï¼šAåŒº">
                             </div>
                             <div class="form-group">
                                 <label for="hallDescription">æè¿°:</label>
                                 <textarea id="hallDescription" rows="3" placeholder="è¯·è¾“å…¥å±•å…æè¿°..."></textarea>
                             </div>
                             <div class="form-group">
                                 <label for="hallPanoramaURL">å…¨æ™¯URL:</label>
                                 <input type="url" id="hallPanoramaURL" placeholder="ä¾‹ï¼šhttp://example.com/panorama/hall1.jpg">
                              </div>
                              <div class="form-group">
                                 <label for="hallSequence">æ’åº:</label>
                                 <input type="number" id="hallSequence" placeholder="ä¾‹ï¼š1">
                              </div>
                              <!-- ArtifactCount, CreateTime é€šå¸¸ç”±åç«¯å¤„ç†æˆ–ä¸éœ€è¦å‰ç«¯æäº¤ -->

                             <button type="submit" class="btn">æ·»åŠ å±•å…</button>
                         </form>
                     </div>

                      <!-- å±•å…åˆ—è¡¨åŒºåŸŸ -->
                      <div class="card">
                         <h3>ğŸ“‹ å±•å…åˆ—è¡¨</h3>
                         <table class="data-table" id="exhibitionHallsTable">
                             <thead>
                                 <tr>
                                     <th>ID</th>
                                     <th>åç§°</th>
                                     <th>æ¥¼å±‚</th>
                                     <th>åŒºåŸŸç </th>
                                     <th>æ–‡ç‰©æ•°é‡</th>
                                     <th>æ“ä½œ</th>
                                 </tr>
                             </thead>
                             <tbody id="exhibitionHallsTableBody">
                                 <!-- å±•å…æ•°æ®å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                                 <tr><td colspan="6">åŠ è½½ä¸­...</td></tr> <!-- åˆå§‹åŠ è½½æç¤º -->
                             </tbody>
                         </table>
                     </div>
                 </section>

                 <!-- ç”¨æˆ·ç®¡ç† Section -->
                 <section id="user-management" class="section">
                     <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†</h2>
                     <p>æ­¤åŒºåŸŸç”¨äºå±•ç¤ºç”¨æˆ·åˆ—è¡¨ã€æ·»åŠ æ–°ç”¨æˆ·ç­‰æ“ä½œã€‚</p>
                     <!-- TODO: åœ¨æ­¤æ·»åŠ ç”¨æˆ·ç®¡ç†ç›¸å…³çš„è¡¨å•ã€è¡¨æ ¼ç­‰å…·ä½“HTMLå…ƒç´  -->

                     <!-- ç”¨æˆ·åˆ—è¡¨åŒºåŸŸ -->
                     <div class="card" style="margin-top: 20px;">
                         <h3>ğŸ“‹ ç”¨æˆ·åˆ—è¡¨</h3>
                         <table class="data-table" id="usersTable">
                             <thead>
                                 <tr>
                                     <th>ID</th>
                                     <th>OpenID</th>
                                     <th>æ˜µç§°</th>
                                     <th>å¤´åƒ</th>
                                     <th>æ€§åˆ«</th>
                                     <th>å¹´é¾„æ®µ</th>
                                     <th>è®¿é—®æ¬¡æ•°</th>
                                     <th>æ”¶è—æ¬¡æ•°</th>
                                     <th>è§’è‰²</th>
                                     <th>åˆ›å»ºæ—¶é—´</th>
                                     <th>æœ€åç™»å½•æ—¶é—´</th>
                                     <th>æ“ä½œ</th>
                                 </tr>
                             </thead>
                             <tbody id="usersTableBody">
                                 <!-- ç”¨æˆ·æ•°æ®å°†ç”±JavaScriptåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                                 <tr><td colspan="11">åŠ è½½ä¸­...</td></tr> <!-- åˆå§‹åŠ è½½æç¤º -->
                             </tbody>
                         </table>
                     </div>

                     <!-- ç”¨æˆ·æ·»åŠ è¡¨å•åŒºåŸŸ -->
                     <div class="card" style="margin-bottom: 20px;">
                         <h3>ğŸ“ æ·»åŠ æ–°ç”¨æˆ·</h3>
                         <form id="addUserForm">
                             <div class="form-group">
                                 <label for="userOpenID">OpenID:</label>
                                 <input type="text" id="userOpenID" required placeholder="è¯·è¾“å…¥ç”¨æˆ·OpenID">
                             </div>
                             <div class="form-group">
                                 <label for="userNickname">æ˜µç§°:</label>
                                 <input type="text" id="userNickname" placeholder="è¯·è¾“å…¥ç”¨æˆ·æ˜µç§°">
                             </div>
                             <div class="form-group">
                                 <label for="userAvatarURL">å¤´åƒURL:</label>
                                 <input type="url" id="userAvatarURL" placeholder="è¯·è¾“å…¥å¤´åƒå›¾ç‰‡URL">
                             </div>
                             <div class="form-group">
                                 <label for="userGender">æ€§åˆ«:</label>
                                 <select id="userGender">
                                     <option value="">-- é€‰æ‹©æ€§åˆ« --</option>
                                     <option value="Male">ç”·</option>
                                     <option value="Female">å¥³</option>
                                     <option value="Other">å…¶ä»–</option>
                                     <option value="Unknown">æœªçŸ¥</option>
                                 </select>
                             </div>
                             <div class="form-group">
                                 <label for="userAgeGroup">å¹´é¾„æ®µ:</label>
                                  <input type="text" id="userAgeGroup" placeholder="ä¾‹ï¼š20-29">
                              </div>
                             <div class="form-group">
                                 <label for="userRole">è§’è‰²:</label>
                                 <select id="userRole" required>
                                      <option value="">-- é€‰æ‹©è§’è‰² --</option>
                                      <option value="Normal">æ™®é€šç”¨æˆ·</option>
                                      <option value="Admin">ç®¡ç†å‘˜</option>
                                  </select>
                              </div>

                             <button type="submit" class="btn">æ·»åŠ ç”¨æˆ·</button>
                         </form>
                     </div>

                 </section>
             </div>
         </div>
     </div>

    <script>
        // Store loaded artifacts for searching
        window.currentArtifacts = [];

        // Store the ID of the artifact being edited (null when adding new)
        window.editingArtifactId = null;

        // Store loaded activities
        window.currentActivities = []; // æ–°å¢ï¼šå­˜å‚¨åŠ è½½çš„æ´»åŠ¨æ•°æ®
        window.editingActivityId = null; // æ–°å¢ï¼šå­˜å‚¨æ­£åœ¨ç¼–è¾‘çš„æ´»åŠ¨ID

        // Store loaded exhibition halls
        window.currentExhibitionHalls = [];

        // Store loaded users
        window.currentUsers = [];

        // Store the ID of the user being edited (null when adding new)
        window.editingUserId = null;

        // Global variable to store current user role
        window.currentUserRole = null; // 'Normal' or 'Admin'

        // Function to show selected section
        async function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            } else {
                 console.error('Section not found:', sectionId);
                 // Optionally, default to overview or show an error message on the page
                 document.getElementById('overview').classList.add('active');
            }


            // Update active navigation button
            const navBtns = document.querySelectorAll('.main-nav .nav-btn');
            navBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`.main-nav .nav-btn[data-target='${sectionId}']`);
            if (activeBtn) {
               activeBtn.classList.add('active');
            }


            // Load data for the selected section
            if (sectionId === 'artifact-management') {
                 await loadArtifacts(); // Make sure artifacts are loaded
                 displayArtifacts(window.currentArtifacts); // Display in management table
             } else if (sectionId === 'artifact-info') {
                 await loadArtifacts(); // Load artifacts for audience view
                 displayArtifactsForAudience(window.currentArtifacts); // Display in audience view
              } else if (sectionId === 'overview') {
                  await loadOverviewData(); // Placeholder for loading overview data
              } else if (sectionId === 'multimedia-interaction') {
                  await loadArtifacts(); // Load artifacts (for multimedia links)
                  await loadExhibitionHallData(); // Load exhibition halls (for panorama links)
                  displayMultimediaContent(window.currentArtifacts, window.currentExhibitionHalls); // Display multimedia content
              } else if (sectionId === 'device-management') {
                  await loadDeviceData(); // è°ƒç”¨åŠ è½½è®¾å¤‡æ•°æ®çš„å‡½æ•°
              } else if (sectionId === 'community') {
                  // Load artifacts for the related artifact dropdown
                  if (!window.currentArtifacts || window.currentArtifacts.length === 0) {
                      await loadArtifacts();
                  }
                  loadArtifactOptionsForCommunity(); // Populate artifact dropdown for community form
                  await loadUserBehaviorData(); // Load user behaviors
                  // displayCommunityPosts is called within loadUserBehaviorData now
              } else if (sectionId === 'activity-management') {
                  await loadActivityData(); // è°ƒç”¨åŠ è½½æ´»åŠ¨æ•°æ®çš„å‡½æ•°
              } else if (sectionId === 'data-dashboard') {
                  loadVisitorData(); // Placeholder
                  await loadUserBehaviorData(); // Load user behaviors for the dashboard
                  // displayUserBehaviorData is called within loadUserBehaviorData
              } else if (sectionId === 'exhibition-hall-management') {
                  await loadExhibitionHallData(); // è°ƒç”¨åŠ è½½å±•å…æ•°æ®çš„å‡½æ•°
              } else if (sectionId === 'ai-qa') {
                  // Ensure artifacts are loaded before populating the dropdown
                  if (!window.currentArtifacts || window.currentArtifacts.length === 0) {
                      await loadArtifacts(); // Load artifacts if not already loaded
                  }
                  loadQAData(); // Load QA data
                  loadArtifactOptionsForQA(); // Populate artifact dropdown
              } else if (sectionId === 'user-management') {
                  await loadUserData(); // è°ƒç”¨åŠ è½½ç”¨æˆ·æ•°æ®çš„å‡½æ•°
              }
        }

        // Function to load overview data (placeholder)
        async function loadOverviewData() {
            console.log("Loading overview data...");
            // Call existing functions to load data
            await loadArtifacts();
            await loadDeviceData();
            await loadActivityData(); // Load activities
            await loadUserBehaviorData(); // Assuming user behavior data includes visitor info

            // After data is loaded, update overview sections
             updateOverviewStats(); // Update stats based on loaded data
             loadPopularArtifactsTable(); // Update popular artifacts table
             loadDeviceAlerts(); // Update device alerts
             displayLatestActivities(); // Display latest activities (New Call)
        }

         function updateOverviewStats() {
             console.log("Updating overview stats...");
              // Update total artifacts count based on loaded artifacts
              document.getElementById('totalArtifacts').textContent = window.currentArtifacts ? window.currentArtifacts.length : 0;
              // Update online devices based on loaded devices
              const onlineDevices = window.currentDevices ? window.currentDevices.filter(device => device.Status === 'åœ¨çº¿').length : 0;
              document.getElementById('onlineDevices').textContent = onlineDevices;

              // Update active events based on loaded activities
              // Assuming activities have a status or check start/end time
              const now = new Date();
              const activeEvents = window.currentActivities ? window.currentActivities.filter(activity => {
                  const startTime = new Date(activity.StartTime);
                  const endTime = activity.EndTime ? new Date(activity.EndTime) : null;
                  return startTime <= now && (!endTime || endTime >= now);
              }).length : 0;
              document.getElementById('activeEvents').textContent = activeEvents;

              // Update today's visitors (This is a placeholder, requires specific user behavior data)
              // You would need to filter user behavior data for today's visits if available
              // For now, it remains a placeholder or uses a simple count from user data if available
              // const todayVisitors = window.currentUserBehaviors ? window.currentUserBehaviors.filter(...).length : 0; // Example logic
              // If you have a user count in userData:
              const totalUsers = window.currentUsers ? window.currentUsers.length : 0;
               document.getElementById('todayVisitors').textContent = totalUsers; // Using total users as a placeholder for now
         }

         function loadPopularArtifactsTable() {
             console.log("Loading popular artifacts table...");
              const popularArtifactsTableBody = document.getElementById('popularArtifactsTableBody');
               if (popularArtifactsTableBody) {
                   popularArtifactsTableBody.innerHTML = ''; // Clear previous
                   const artifacts = window.currentArtifacts || [];

                   if (artifacts.length === 0) {
                       popularArtifactsTableBody.innerHTML = '<tr><td colspan="2">æš‚æ— çƒ­é—¨æ–‡ç‰©æ•°æ®ã€‚</td></tr>';
                       return;
                   }

                   // Sort artifacts by ViewCount in descending order
                   const sortedArtifacts = [...artifacts].sort((a, b) => (b.ViewCount || 0) - (a.ViewCount || 0));

                   // Display top N popular artifacts (e.g., top 5)
                   const topN = 5;
                   sortedArtifacts.slice(0, topN).forEach(artifact => {
                       const row = document.createElement('tr');
                       row.innerHTML = `<tr><td>${artifact.Name || 'æœªçŸ¥'}</td><td>${artifact.ViewCount || 0}</td></tr>`;
                       popularArtifactsTableBody.appendChild(row);
                   });
               }
         }

         function loadDeviceAlerts() {
             console.log("Loading device alerts...");
              const deviceAlertsDiv = document.getElementById('deviceAlerts');
              if (deviceAlertsDiv) {
                   deviceAlertsDiv.innerHTML = ''; // Clear previous
                   const devices = window.currentDevices || [];

                   // Filter devices with high or medium alert level or Status is 'å‘Šè­¦'
                   const alertingDevices = devices.filter(device => 
                       device.AlertLevel === 'High' || device.AlertLevel === 'Medium' || device.Status === 'å‘Šè­¦'
                   );

                   if (alertingDevices.length === 0) {
                       deviceAlertsDiv.innerHTML = '<p style="color: #28a745;">âœ… æ‰€æœ‰è®¾å¤‡è¿è¡Œæ­£å¸¸</p>';
                   } else {
                       const alertList = document.createElement('ul');
                       alertList.style.listStyle = 'none';
                       alertList.style.padding = '0';
                       alertingDevices.forEach(device => {
                           const listItem = document.createElement('li');
                           listItem.style.color = '#dc3545'; // Red color for alerts
                           listItem.innerHTML = `<strong>è®¾å¤‡ID: ${device.DeviceID || 'æœªçŸ¥'}</strong> (${device.DeviceType || 'æœªçŸ¥'}): ${device.AlertMessage || 'æ— å‘Šè­¦ä¿¡æ¯'} (çº§åˆ«: ${device.AlertLevel || 'æœªçŸ¥'})`;
                           alertList.appendChild(listItem);
                       });
                       deviceAlertsDiv.appendChild(alertList);
                   }
               }
         }

        // Function to load artifacts from the backend API
        async function loadArtifacts() {
            const artifactsTableBody = document.getElementById('artifactsTableBody');
            // Check if artifactsTableBody exists before trying to update it
            if (!artifactsTableBody) {
                console.error('Artifacts table body not found.');
                return;
            }
            artifactsTableBody.innerHTML = '<tr><td colspan="9">åŠ è½½ä¸­...</td></tr>'; // Loading indicator

            try {
                const response = await fetch('http://192.168.31.201:5000/api/artifacts');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const artifacts = await response.json();

                // Store artifacts data globally or in a way accessible to search
                window.currentArtifacts = artifacts; // Store for searching

                displayArtifacts(artifacts); // Display all loaded artifacts initially

                 // Update total artifacts count in overview if overview section exists
                 const totalArtifactsElement = document.getElementById('totalArtifacts');
                 if(totalArtifactsElement) {
                     totalArtifactsElement.textContent = artifacts.length;
                 }


            } catch (error) {
                console.error('Error loading artifacts:', error);
                if (artifactsTableBody) {
                     artifactsTableBody.innerHTML = `<tr><td colspan="9" style="color: red;">åŠ è½½æ–‡ç‰©æ•°æ®å¤±è´¥: ${error.message}</td></tr>`;
                }
                 // Update total artifacts count to indicate error or zero
                 const totalArtifactsElement = document.getElementById('totalArtifacts');
                 if(totalArtifactsElement) {
                     totalArtifactsElement.textContent = 'Error'; // Or '0' or '-'
                 }
            }
        }

        // Function to display artifacts in the table
        function displayArtifacts(artifactsToDisplay) {
             const artifactsTableBody = document.getElementById('artifactsTableBody');
              // Check if artifactsTableBody exists before trying to update it
            if (!artifactsTableBody) {
                console.error('Artifacts table body not found for display.');
                return;
            }
             artifactsTableBody.innerHTML = ''; // Clear previous entries

             if (artifactsToDisplay.length === 0) {
                 artifactsTableBody.innerHTML = '<tr><td colspan="9">æš‚æ— æ–‡ç‰©æ•°æ®ã€‚</td></tr>'; // æ›´æ–°colspan
                 return;
             }

             // Mapping for location values to display text
             const locationMap = {
                 'ancient': 'å¤ä»£æ–‡æ˜å…',
                 'ceramic': 'é™¶ç“·è‰ºæœ¯å…',
                 'bronze': 'é’é“œå™¨å…',
                 'calligraphy': 'å­—ç”»å…',
                 // Add other mappings if you have more locations from your database
                 '': 'æœªçŸ¥å±•å…' // Handle empty or null location from database
             };

             artifactsToDisplay.forEach(artifact => {
                 const row = document.createElement('tr');
                 // Get the display text for the location, default to the stored value if not found in map
                 // Also handle potential null or undefined values from the API response gracefully
                 const artifactLocation = artifact.Location;
                 const displayLocation = (artifactLocation !== null && artifactLocation !== undefined && locationMap[artifactLocation]) ? locationMap[artifactLocation] : artifactLocation || 'æœªçŸ¥';

                 // å¤„ç† boolean ç±»å‹å­—æ®µçš„æ˜¾ç¤º
                 const isHotDisplay = artifact.IsHot ? 'æ˜¯' : 'å¦';
                 const isNewDisplay = artifact.IsNew ? 'æ˜¯' : 'å¦';

                 row.innerHTML = `
                     <td>${artifact.ID || 'N/A'}</td>
                     <td>${artifact.Name || 'N/A'}</td>
                     <td>${artifact.Category || 'æœªçŸ¥'}</td>
                     <td>${artifact.Era || 'æœªçŸ¥'}</td>
                     <td>${displayLocation}</td> <!-- Use the mapped location here -->
                     <td>${artifact.ViewCount || 0}</td> <!-- æ˜¾ç¤ºæµè§ˆæ¬¡æ•°ï¼Œé»˜è®¤ä¸º0 -->
                     <td>${isHotDisplay}</td>
                     <td>${isNewDisplay}</td>
                     <td>
                         <button class="btn btn-secondary btn-sm" onclick="editArtifact('${artifact.ID}')">ç¼–è¾‘</button>
                         <button class="btn btn-secondary btn-sm" onclick="deleteArtifact('${artifact.ID}')">åˆ é™¤</button>
                     </td>
                 `;
                 artifactsTableBody.appendChild(row);
             });
        }


        // Function to handle adding or updating an artifact
        const artifactForm = document.getElementById('addArtifactForm');
        const submitButton = artifactForm ? artifactForm.querySelector('button[type="submit"]') : null; // è·å–æäº¤æŒ‰é’®

        if (artifactForm && submitButton) {
            artifactForm.addEventListener('submit', async function(event) {
                event.preventDefault(); // Prevent default form submission

                // ç¦ç”¨æäº¤æŒ‰é’®é˜²æ­¢é‡å¤æäº¤
                submitButton.disabled = true;
                submitButton.textContent = window.editingArtifactId ? 'æ›´æ–°ä¸­...' : 'æ·»åŠ ä¸­...';

                // è·å–æ–‡ä»¶è¾“å…¥æ¡†
                const imageFile = document.getElementById('artifactImageFile').files[0];
                const audioFile = document.getElementById('artifactAudioFile').files[0];

                let imageUrl = document.getElementById('artifactImageUrl').value;
                let audioUrl = document.getElementById('artifactAudioUrl').value;

                // å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶å¹¶è·å–URL
                async function uploadFile(file, fileType) {
                    if (!file) return null; // No file selected

                    console.log(`Uploading ${fileType} file:`, file.name);
                    const formData = new FormData();
                    formData.append('file', file);

                    try {
                        const response = await fetch('http://192.168.31.201:5000/api/upload', {
                            method: 'POST',
                            body: formData
                        });

                        const result = await response.json();

                        if (response.ok) {
                            console.log(`${fileType} upload successful:`, result.url);
                            return result.url;
                        } else {
                            throw new Error(result.error || `ä¸Šä¼ ${fileType}æ–‡ä»¶å¤±è´¥`);
                        }
                    } catch (error) {
                        console.error(`Error uploading ${fileType} file:`, error);
                        throw error; // Re-throw the error to be caught by the main submit handler
                    }
                }

                try {
                    // ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶
                    if (imageFile) {
                        imageUrl = await uploadFile(imageFile, 'å›¾ç‰‡');
                         // æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡† (å¯é€‰)
                         document.getElementById('artifactImageFile').value = '';
                    }

                    // ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
                    if (audioFile) {
                        audioUrl = await uploadFile(audioFile, 'éŸ³é¢‘');
                         // æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡† (å¯é€‰)
                         document.getElementById('artifactAudioFile').value = '';
                    }

                    // æ”¶é›†è¡¨å•æ•°æ® (ä½¿ç”¨ä¸Šä¼ åæˆ–åŸæœ‰çš„URL)
                    const artifactData = {
                        Name: document.getElementById('artifactName').value,
                        Category: document.getElementById('artifactCategory').value,
                        Era: document.getElementById('artifactEra').value,
                        Location: document.getElementById('artifactLocation').value,
                        Description: document.getElementById('artifactDescription').value,
                        ImageURL: imageUrl, // ä½¿ç”¨ä¸Šä¼ åçš„URLæˆ–åŸæœ‰çš„URL
                        AudioURL: audioUrl,   // ä½¿ç”¨ä¸Šä¼ åçš„URLæˆ–åŸæœ‰çš„URL
                        VideoURL: document.getElementById('artifactVideoUrl').value,
                        FeatureTags: document.getElementById('artifactFeatureTags').value,
                        IsHot: document.getElementById('artifactIsHot').checked,
                        IsNew: document.getElementById('artifactIsNew').checked
                    };

                    console.log('æäº¤çš„æ–‡ç‰©æ•°æ®:', artifactData);

                    let url;
                    let method;
                    let successMessage;
                    let errorMessage;

                    // åˆ¤æ–­æ˜¯æ·»åŠ è¿˜æ˜¯ç¼–è¾‘æ¨¡å¼
                    if (window.editingArtifactId) {
                        // ç¼–è¾‘æ¨¡å¼
                        url = `http://192.168.31.201:5000/api/artifacts/${window.editingArtifactId}`;
                        method = 'PUT';
                        successMessage = 'æ–‡ç‰©æ›´æ–°æˆåŠŸï¼';
                        errorMessage = 'æ›´æ–°æ–‡ç‰©å¤±è´¥';
                    } else {
                        // æ·»åŠ æ¨¡å¼
                        url = 'http://192.168.31.201:5000/api/artifacts';
                        method = 'POST';
                        successMessage = 'æ–‡ç‰©æ·»åŠ æˆåŠŸï¼';
                        errorMessage = 'æ·»åŠ æ–‡ç‰©å¤±è´¥';
                    }

                    // å‘åç«¯å‘é€æ–‡ç‰©æ•°æ®è¯·æ±‚
                    const response = await fetch(url, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(artifactData),
                    });

                    const result = await response.json();

                    if (response.ok) {
                        alert(result.message || successMessage);
                        artifactForm.reset();
                        resetArtifactForm(); // é‡ç½®è¡¨å•åˆ°æ·»åŠ æ¨¡å¼çŠ¶æ€
                        loadArtifacts(); // é‡æ–°åŠ è½½æ–‡ç‰©åˆ—è¡¨
                    } else {
                        const msg = result.message || errorMessage;
                        alert(`${errorMessage}: ${msg}`);
                        console.error(`${errorMessage}å“åº”:`, result);
                    }

                } catch (error) {
                    // æ•è·ä¸Šä¼ æˆ–æäº¤æ–‡ç‰©æ•°æ®è¿‡ç¨‹ä¸­çš„é”™è¯¯
                    alert(`æ“ä½œå¤±è´¥: ${error.message}`);
                    console.error('æ“ä½œå¤±è´¥:', error);
                } finally {
                    // æ¢å¤æäº¤æŒ‰é’®çŠ¶æ€
                    submitButton.disabled = false;
                    submitButton.textContent = window.editingArtifactId ? 'æ›´æ–°æ–‡ç‰©' : 'æ·»åŠ æ–‡ç‰©';
                }
            });
        }

        // Function to reset the artifact form to add mode
        function resetArtifactForm() {
            window.editingArtifactId = null;
            const submitButton = document.querySelector('#addArtifactForm button[type="submit"]');
            if (submitButton) {
                submitButton.textContent = 'æ·»åŠ æ–‡ç‰©';
            }
            // æ¸…ç©ºè¡¨å•ï¼ˆç”± form.reset() å¤„ç†ï¼‰
        }

        // Function to handle artifact search (filters currently loaded artifacts)
        function searchArtifacts() {
            const searchInput = document.getElementById('searchInput');
            const filter = searchInput.value.toUpperCase(); // Get input value and convert to uppercase for case-insensitive search
            const allArtifacts = window.currentArtifacts || []; // Get artifacts from stored data

            const filteredArtifacts = allArtifacts.filter(artifact => {
                // Search in ID, Name, Era, Location, Description (adjust fields as needed based on backend response)
                // Ensure artifact properties match those returned by the backend /api/artifacts GET endpoint
                const idMatch = artifact.ID && String(artifact.ID).toUpperCase().includes(filter); // Convert ID to string for search
                const nameMatch = artifact.Name && String(artifact.Name).toUpperCase().includes(filter);
                const eraMatch = artifact.Era && String(artifact.Era).toUpperCase().includes(filter);
                // Use the raw Location value from the backend for searching before mapping for display
                const locationMatch = artifact.Location && String(artifact.Location).toUpperCase().includes(filter);
                const descriptionMatch = artifact.Description && String(artifact.Description).toUpperCase().includes(filter);


                return idMatch || nameMatch || eraMatch || locationMatch || descriptionMatch;
            });

            displayArtifacts(filteredArtifacts); // Display filtered results
        }


        // Function to handle Edit artifact button click
        function editArtifact(id) {
            // åœ¨å·²åŠ è½½çš„æ–‡ç‰©åˆ—è¡¨ä¸­æŸ¥æ‰¾è¦ç¼–è¾‘çš„æ–‡ç‰©
            // å°†ä¼ å…¥çš„å­—ç¬¦ä¸²IDè½¬æ¢ä¸ºæ•°å­—è¿›è¡ŒæŸ¥æ‰¾
            const artifactIdNum = parseInt(id, 10); // å°†å­—ç¬¦ä¸²IDè½¬æ¢ä¸ºæ•´æ•°
            const artifactToEdit = window.currentArtifacts.find(artifact => artifact.ID === artifactIdNum);

            if (artifactToEdit) {
                // å°†æ–‡ç‰©æ•°æ®å¡«å……åˆ°è¡¨å•
                document.getElementById('artifactName').value = artifactToEdit.Name || '';
                document.getElementById('artifactCategory').value = artifactToEdit.Category || '';
                document.getElementById('artifactEra').value = artifactToEdit.Era || '';
                document.getElementById('artifactLocation').value = artifactToEdit.Location || '';
                document.getElementById('artifactDescription').value = artifactToEdit.Description || '';
                document.getElementById('artifactImageUrl').value = artifactToEdit.ImageURL || '';
                document.getElementById('artifactAudioUrl').value = artifactToEdit.AudioURL || '';
                document.getElementById('artifactVideoUrl').value = artifactToEdit.VideoURL || '';
                document.getElementById('artifactFeatureTags').value = artifactToEdit.FeatureTags || '';
                document.getElementById('artifactIsHot').checked = artifactToEdit.IsHot || false;
                document.getElementById('artifactIsNew').checked = artifactToEdit.IsNew || false;

                // è®¾ç½®æ­£åœ¨ç¼–è¾‘çš„æ–‡ç‰©IDï¼Œå¹¶æ”¹å˜æŒ‰é’®æ–‡æœ¬
                window.editingArtifactId = id;
                const submitButton = document.querySelector('#addArtifactForm button[type="submit"]');
                if (submitButton) {
                    submitButton.textContent = 'æ›´æ–°æ–‡ç‰©';
                }

                // å¯ä»¥æ»šåŠ¨åˆ°è¡¨å•åŒºåŸŸï¼Œæ–¹ä¾¿ç”¨æˆ·ç¼–è¾‘
                artifactForm.scrollIntoView({ behavior: 'smooth' });

            } else {
                alert('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„æ–‡ç‰©ã€‚');
                console.error('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„æ–‡ç‰©ï¼ŒID:', id);
            }
        }

        // Function to handle delete artifact button click
        function deleteArtifact(id) {
             if (confirm('ç¡®å®šè¦åˆ é™¤æ–‡ç‰©ç¼–å·ä¸º ' + id + ' çš„æ–‡ç‰©å—ï¼Ÿ')) {
                 deleteArtifactFromBackend(id); // Call the new function to delete from backend
             }
        }

        // Function to delete artifact from backend
        async function deleteArtifactFromBackend(id) {
            try {
                // å‘åç«¯å‘é€DELETEè¯·æ±‚
                const response = await fetch(`http://192.168.31.201:5000/api/artifacts/${id}`, {
                    method: 'DELETE',
                });

                const result = await response.json();

                if (response.ok) {
                    // è¯·æ±‚æˆåŠŸï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å¹¶åˆ·æ–°æ–‡ç‰©åˆ—è¡¨
                    alert(result.message || 'æ–‡ç‰©åˆ é™¤æˆåŠŸï¼');
                    loadArtifacts(); // é‡æ–°åŠ è½½æ–‡ç‰©åˆ—è¡¨
                } else {
                    // è¯·æ±‚å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                    const errorMessage = result.message || 'åˆ é™¤æ–‡ç‰©å¤±è´¥';
                    alert(`åˆ é™¤æ–‡ç‰©å¤±è´¥: ${errorMessage}`);
                    console.error('åˆ é™¤æ–‡ç‰©å¤±è´¥å“åº”:', result);
                }

            } catch (error) {
                // ç½‘ç»œæˆ–å…¶ä»–é”™è¯¯
                console.error('å‘é€åˆ é™¤æ–‡ç‰©è¯·æ±‚æ—¶å‡ºé”™:', error);
                alert(`åˆ é™¤æ–‡ç‰©å¤±è´¥: ${error.message}`);
            }
        }


        // Placeholder function for QR scan simulation
        function simulateQRScan() {
            alert('æ¨¡æ‹ŸäºŒç»´ç æ‰«æåŠŸèƒ½å¾…å®ç°');
            // TODO: Implement actual QR scanning using a library or API
        }

        // Function to load device data from the backend API
        async function loadDeviceData() {
             console.log("Loading device data...");

             const devicesTableBody = document.getElementById('devicesTableBody');
              if (!devicesTableBody) {
                   console.error('Devices table body not found.');
                   return;
               }
               devicesTableBody.innerHTML = '<tr><td colspan="10">åŠ è½½ä¸­...</td></tr>'; // Loading indicator

               try {
                   const response = await fetch('http://192.168.31.201:5000/api/devices');
                   if (!response.ok) {
                       throw new Error(`HTTP error! status: ${response.status}`);
                   }
                   const devices = await response.json();

                   window.currentDevices = devices; // Store device data

                   displayDeviceStatus(devices); // æ˜¾ç¤ºè®¾å¤‡çŠ¶æ€åˆ—è¡¨

                   // æ›´æ–°ç¯å¢ƒç›‘æ§å’Œäººæµç›‘æ§ç»Ÿè®¡å¡ç‰‡
                   updateEnvironmentAndVisitorStats(devices); // æ–°å¢ï¼šè°ƒç”¨å‡½æ•°æ›´æ–°ç»Ÿè®¡æ•°æ®

               } catch (error) {
                   console.error('Error loading devices:', error);
                   devicesTableBody.innerHTML = `<tr><td colspan="10" style="color: red;">åŠ è½½è®¾å¤‡æ•°æ®å¤±è´¥: ${error.message}</td></tr>`;
               }
         }

         // Function to update environment and visitor stats (New Function)
         function updateEnvironmentAndVisitorStats(devices) {
             console.log("Updating environment and visitor stats...");

             let temperature = '--';
             let humidity = '--';
             let currentVisitors = '--';
             let peakTime = '--:--'; // é€šå¸¸éœ€è¦å†å²æ•°æ®è®¡ç®—ï¼Œè¿™é‡Œæš‚æ—¶é™æ€æˆ–æ¨¡æ‹Ÿ

             if (devices && devices.length > 0) {
                 // éå†è®¾å¤‡æ•°æ®ï¼ŒæŸ¥æ‰¾ç¯å¢ƒå’Œäººæµè®¾å¤‡
                 devices.forEach(device => {
                     if (device.DeviceType === 'temperature' && device.Value !== null) {
                         temperature = parseFloat(device.Value).toFixed(1); // å‡è®¾Valueæ˜¯æ¸©åº¦å€¼
                     } else if (device.DeviceType === 'humidity' && device.Value !== null) {
                         humidity = parseFloat(device.Value).toFixed(0); // å‡è®¾Valueæ˜¯æ¹¿åº¦å€¼
                     } else if ((device.DeviceType === 'visitor_counter' || device.DeviceType === 'camera') && device.Value !== null) {
                          // å‡è®¾æä¾›äº†å½“å‰äººæµè®¡æ•°ï¼Œä¼˜å…ˆ visitor_counter
                          if (device.DeviceType === 'visitor_counter') {
                               currentVisitors = parseInt(device.Value, 10);
                          } else if (device.DeviceType === 'camera' && currentVisitors === '--') {
                              // å¦‚æœæ²¡æœ‰visitor_counterï¼Œå°è¯•ä½¿ç”¨cameraçš„å€¼ï¼ˆå¦‚æœæä¾›äº†äººæ•°ï¼‰
                               // è¿™é‡Œå‡è®¾cameraçš„Valueä¹Ÿå¯èƒ½æ˜¯äººæ•°ï¼Œå¦‚æœä¸æ˜¯è¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
                              currentVisitors = parseInt(device.Value, 10);
                          }
                     }
                     // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–ç±»å‹çš„è®¾å¤‡å¤„ç†ï¼Œå¦‚ç©ºæ°”è´¨é‡ç­‰
                 });
             }

             // å¦‚æœæ²¡æœ‰ä»åç«¯è·å–åˆ°æ•°æ®ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å¡«å……
             if (temperature === '--') temperature = (22.5 + Math.random() * 3).toFixed(1); // æ¨¡æ‹Ÿæ¸©åº¦
             if (humidity === '--') humidity = (55 + Math.random() * 10).toFixed(0); // æ¨¡æ‹Ÿæ¹¿åº¦
             if (currentVisitors === '--') currentVisitors = Math.floor(30 + Math.random() * 50); // æ¨¡æ‹Ÿäººæµ
             // Peak Time remains static for now
             // peakTime = '14:30'; // æ¨¡æ‹Ÿé«˜å³°æ—¶æ®µ

             // æ›´æ–°é¡µé¢ä¸Šçš„ç»Ÿè®¡å…ƒç´ 
             const temperatureElement = document.getElementById('temperature');
             const humidityElement = document.getElementById('humidity');
             const currentVisitorsElement = document.getElementById('currentVisitors');
             const peakTimeElement = document.getElementById('peakTime');

             if (temperatureElement) temperatureElement.textContent = temperature + 'Â°C';
             if (humidityElement) humidityElement.textContent = humidity + '%';
             if (currentVisitorsElement) currentVisitorsElement.textContent = currentVisitors;
             if (peakTimeElement) peakTimeElement.textContent = peakTime; // è®¾ç½®é™æ€æˆ–æ¨¡æ‹Ÿçš„é«˜å³°æ—¶æ®µ

              // TODO: å¦‚æœæœ‰è®¾å¤‡å‘Šè­¦ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ ¹æ® AlertLevel å’Œ AlertMessage æ›´æ–°å‘Šè­¦åŒºåŸŸ
         }

         function controlDevice(name) {
             alert(`è®¾å¤‡æ§åˆ¶ï¼š${name}\nï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ä¼šæ˜¾ç¤ºè®¾å¤‡æ§åˆ¶é¢æ¿ï¼‰`);
             // Implement device control logic
         }

         // Function to load activities from the backend API (New Function)
         async function loadActivityData() {
             const activitiesTableBody = document.getElementById('activitiesTableBody');
             if (!activitiesTableBody) {
                 console.error('Activities table body not found.');
                 return;
             }
             activitiesTableBody.innerHTML = '<tr><td colspan="10">åŠ è½½ä¸­...</td></tr>'; // Loading indicator, update colspan if needed

             try {
                 const response = await fetch('http://192.168.31.201:5000/api/activities');
                 if (!response.ok) {
                     throw new Error(`HTTP error! status: ${response.status}`);
                 }
                 const activities = await response.json();

                 window.currentActivities = activities; // å­˜å‚¨æ´»åŠ¨æ•°æ®

                 displayActivities(activities); // æ˜¾ç¤ºæ´»åŠ¨åˆ—è¡¨

                 // TODO: Update activity related stats in overview or activity section if any

             } catch (error) {
                 console.error('Error loading activities:', error);
                 activitiesTableBody.innerHTML = `<tr><td colspan="10" style="color: red;">åŠ è½½æ´»åŠ¨æ•°æ®å¤±è´¥: ${error.message}</td></tr>`; // Update colspan if needed
             }
         }

         // Function to display activities in the table (New Function)
         function displayActivities(activitiesToDisplay) {
             const activitiesTableBody = document.getElementById('activitiesTableBody');
             if (!activitiesTableBody) {
                 console.error('Activities table body not found for display.');
                 return;
             }
             activitiesTableBody.innerHTML = ''; // Clear previous entries

             if (activitiesToDisplay.length === 0) {
                 activitiesTableBody.innerHTML = '<tr><td colspan="10">æš‚æ— æ´»åŠ¨æ•°æ®ã€‚</td></tr>'; // Update colspan if needed
                 return;
             }

             activitiesToDisplay.forEach(activity => {
                 const row = document.createElement('tr');

                 // å¤„ç† boolean ç±»å‹å­—æ®µçš„æ˜¾ç¤º
                 const isPublishedDisplay = activity.IsPublished ? 'æ˜¯' : 'å¦';

                 // å¤„ç†æ—¥æœŸæ—¶é—´æ ¼å¼ï¼Œåªæ˜¾ç¤ºæ—¥æœŸå’Œæ—¶é—´ï¼Œç§»é™¤ç§’å’Œæ—¶åŒºä¿¡æ¯
                 const formatDateTime = (datetimeString) => {
                      if (!datetimeString) return '';
                      try {
                          // ISOæ ¼å¼å­—ç¬¦ä¸²ç¤ºä¾‹: 2023-10-27T10:30:00 or 2023-10-27T10:30:00.000Z
                          // datetime-local è¾“å‡ºæ ¼å¼ç¤ºä¾‹: 2023-10-27T10:30
                          // ç›®æ ‡æ ¼å¼ç¤ºä¾‹: 2023-10-27 10:30
                          const date = new Date(datetimeString);
                          // ä½¿ç”¨ Intl.DateTimeFormat æˆ–æ‰‹åŠ¨æ„å»ºæ ¼å¼
                          const year = date.getFullYear();
                          const month = ('0' + (date.getMonth() + 1)).slice(-2);
                          const day = ('0' + date.getDate()).slice(-2);
                          const hours = ('0' + date.getHours()).slice(-2);
                          const minutes = ('0' + date.getMinutes()).slice(-2);
                          return `${year}-${month}-${day} ${hours}:${minutes}`;
                      } catch (e) {
                          console.error('Error formatting date:', datetimeString, e);
                          return datetimeString; // æ ¼å¼åŒ–å¤±è´¥æ—¶è¿”å›åŸå§‹å­—ç¬¦ä¸²
                      }
                  };

                 const startTimeDisplay = formatDateTime(activity.StartTime);
                 const endTimeDisplay = formatDateTime(activity.EndTime);


                 row.innerHTML = `
                     <td>${activity.ID || 'N/A'}</td>
                     <td>${activity.Title || 'N/A'}</td>
                     <td>${activity.Type || 'æœªçŸ¥'}</td>
                     <td>${startTimeDisplay}</td>
                     <td>${endTimeDisplay}</td>
                     <td>${activity.Location || 'æœªçŸ¥'}</td>
                      <td>${activity.MaxParticipants || 'ä¸é™'}</td>
                     <td>${activity.CurrentParticipants || 0}</td>
                     <td>${isPublishedDisplay}</td>
                     <td>
                         <button class="btn btn-secondary btn-sm" onclick="editActivityItem('${activity.ID}')">ç¼–è¾‘</button>
                         <button class="btn btn-secondary btn-sm" onclick="deleteActivityItem('${activity.ID}')">åˆ é™¤</button>
                     </td>
                 `;
                 activitiesTableBody.appendChild(row);
             });
         }
         // å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶å¹¶è·å–URL (å…¨å±€å¯ç”¨çš„å‡½æ•°)
         // å°†æ­¤å‡½æ•°æ”¾åœ¨æ‰€æœ‰éœ€è¦è°ƒç”¨å®ƒçš„è¡¨å•æäº¤é€»è¾‘çš„ä¸Šæ–¹
         async function uploadFile(file, fileType) {
             if (!file) return null; // No file selected

             console.log(`Uploading ${fileType} file:`, file.name);
             const formData = new FormData();
             formData.append('file', file);

             try {
                 const response = await fetch('http://192.168.31.201:5000/api/upload', {
                     method: 'POST',
                     body: formData
                 });

                 const result = await response.json();

                 if (response.ok) {
                     console.log(`${fileType} upload successful:`, result.url);
                     return result.url;
                 } else {
                     throw new Error(result.error || `ä¸Šä¼ ${fileType}æ–‡ä»¶å¤±è´¥`);
                 }
             } catch (error) {
                 console.error(`Error uploading ${fileType} file:`, error);
                 throw error; // Re-throw the error to be caught by the main submit handler
             }
         }

         // Function to handle adding or updating an activity (New Function)
         const activityForm = document.getElementById('addActivityForm');
         const activitySubmitButton = activityForm ? activityForm.querySelector('button[type="submit"]') : null; // è·å–æäº¤æŒ‰é’®

         if (activityForm && activitySubmitButton) {
             activityForm.addEventListener('submit', async function(event) {
                 event.preventDefault(); // Prevent default form submission

                 // ç¦ç”¨æäº¤æŒ‰é’®é˜²æ­¢é‡å¤æäº¤
                 activitySubmitButton.disabled = true;
                 activitySubmitButton.textContent = window.editingActivityId ? 'æ›´æ–°ä¸­...' : 'æ·»åŠ ä¸­...';

                 // è·å–æ–‡ä»¶è¾“å…¥æ¡†
                 const activityImageFile = document.getElementById('activityImageFile').files[0];

                 let activityImageUrl = document.getElementById('activityImageUrl').value;

                 try {
                     // ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶
                     if (activityImageFile) {
                         activityImageUrl = await uploadFile(activityImageFile, 'æ´»åŠ¨å›¾ç‰‡');
                          // æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡† (å¯é€‰)
                          document.getElementById('activityImageFile').value = '';
                     }

                     // æ”¶é›†è¡¨å•æ•°æ® (ä½¿ç”¨ä¸Šä¼ åæˆ–åŸæœ‰çš„URL)
                     const activityData = {
                         Title: document.getElementById('activityTitle').value,
                         Type: document.getElementById('activityType').value,
                         StartTime: document.getElementById('activityStartTime').value,
                         EndTime: document.getElementById('activityEndTime').value,
                         Location: document.getElementById('activityLocation').value,
                         Description: document.getElementById('activityDescription').value,
                         ImageURL: activityImageUrl, // ä½¿ç”¨ä¸Šä¼ åçš„URLæˆ–åŸæœ‰çš„URL
                         MaxParticipants: parseInt(document.getElementById('activityMaxParticipants').value, 10) || null,
                         IsPublished: document.getElementById('activityIsPublished').checked
                     };

                  console.log('æäº¤çš„æ´»åŠ¨æ•°æ®:', activityData);

                 let url;
                 let method;
                 let successMessage;
                 let errorMessage;

                 // åˆ¤æ–­æ˜¯æ·»åŠ è¿˜æ˜¯ç¼–è¾‘æ¨¡å¼
                 if (window.editingActivityId) {
                     // ç¼–è¾‘æ¨¡å¼
                     url = `http://192.168.31.201:5000/api/activities/${window.editingActivityId}`;
                     method = 'PUT';
                     successMessage = 'æ´»åŠ¨æ›´æ–°æˆåŠŸï¼';
                     errorMessage = 'æ›´æ–°æ´»åŠ¨å¤±è´¥';
                 } else {
                     // æ·»åŠ æ¨¡å¼
                     url = 'http://192.168.31.201:5000/api/activities';
                     method = 'POST';
                     successMessage = 'æ´»åŠ¨æ·»åŠ æˆåŠŸï¼';
                     errorMessage = 'æ·»åŠ æ´»åŠ¨å¤±è´¥';
                 }

                 // å‘åç«¯å‘é€è¯·æ±‚
                 const response = await fetch(url, {
                     method: method,
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify(activityData),
                 });

                 const result = await response.json();

                 if (response.ok) {
                     alert(result.message || successMessage);
                     activityForm.reset();
                     resetActivityForm(); // é‡ç½®è¡¨å•åˆ°æ·»åŠ æ¨¡å¼çŠ¶æ€
                     loadActivityData(); // é‡æ–°åŠ è½½æ´»åŠ¨åˆ—è¡¨
                 } else {
                     const msg = result.message || errorMessage;
                     alert(`${errorMessage}: ${msg}`);
                     console.error(`${errorMessage}å“åº”:`, result);
                 }

             } catch (error) {
                  // æ•è·ä¸Šä¼ æˆ–æäº¤æ´»åŠ¨æ•°æ®è¿‡ç¨‹ä¸­çš„é”™è¯¯
                 alert(`æ“ä½œå¤±è´¥: ${error.message}`);
                 console.error('æ“ä½œå¤±è´¥:', error);
             } finally {
                 // æ¢å¤æäº¤æŒ‰é’®çŠ¶æ€
                 activitySubmitButton.disabled = false;
                 activitySubmitButton.textContent = window.editingActivityId ? 'æ›´æ–°æ´»åŠ¨' : 'æ·»åŠ æ´»åŠ¨';
             }
         });
     }
        
        // Function to reset the activity form to add mode (New Function)
        function resetActivityForm() {
            window.editingActivityId = null;
            const activitySubmitButton = document.querySelector('#addActivityForm button[type="submit"]');
            if (activitySubmitButton) {
                activitySubmitButton.textContent = 'æ·»åŠ æ´»åŠ¨';
            }
            // æ¸…ç©ºè¡¨å•ï¼ˆç”± form.reset() å¤„ç†ï¼‰
            // å¦‚æœéœ€è¦æ¸…ç©ºä¸€äº›éæ–‡æœ¬å­—æ®µï¼ˆå¦‚checkboxï¼‰ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰‹åŠ¨è®¾ç½®
        }

        // Function to handle Edit activity button click (New Function)
        function editActivityItem(id) {
            // åœ¨å·²åŠ è½½çš„æ´»åŠ¨åˆ—è¡¨ä¸­æŸ¥æ‰¾è¦ç¼–è¾‘çš„æ´»åŠ¨
            const activityIdNum = parseInt(id, 10); // å°†å­—ç¬¦ä¸²IDè½¬æ¢ä¸ºæ•´æ•°
            const activityToEdit = window.currentActivities.find(activity => activity.ID === activityIdNum);

            if (activityToEdit) {
                // å°†æ´»åŠ¨æ•°æ®å¡«å……åˆ°è¡¨å•
                document.getElementById('activityTitle').value = activityToEdit.Title || '';
                document.getElementById('activityType').value = activityToEdit.Type || '';
                // æ³¨æ„ï¼šdatetime-local è¾“å…¥æ¡†éœ€è¦ YYYY-MM-DDTHH:MM æ ¼å¼çš„å­—ç¬¦ä¸²
                document.getElementById('activityStartTime').value = activityToEdit.StartTime ? new Date(activityToEdit.StartTime).toISOString().slice(0, 16) : '';
                document.getElementById('activityEndTime').value = activityToEdit.EndTime ? new Date(activityToEdit.EndTime).toISOString().slice(0, 16) : '';

                document.getElementById('activityLocation').value = activityToEdit.Location || '';
                document.getElementById('activityDescription').value = activityToEdit.Description || '';
                document.getElementById('activityImageUrl').value = activityToEdit.ImageURL || '';
                document.getElementById('activityMaxParticipants').value = activityToEdit.MaxParticipants || ''; // Number input can take empty string
                document.getElementById('activityIsPublished').checked = activityToEdit.IsPublished || false;

                // è®¾ç½®æ­£åœ¨ç¼–è¾‘çš„æ´»åŠ¨IDï¼Œå¹¶æ”¹å˜æŒ‰é’®æ–‡æœ¬
                window.editingActivityId = id;
                const activitySubmitButton = document.querySelector('#addActivityForm button[type="submit"]');
                if (activitySubmitButton) {
                    activitySubmitButton.textContent = 'æ›´æ–°æ´»åŠ¨';
                }

                // å¯ä»¥æ»šåŠ¨åˆ°è¡¨å•åŒºåŸŸï¼Œæ–¹ä¾¿ç”¨æˆ·ç¼–è¾‘
                activityForm.scrollIntoView({ behavior: 'smooth' });

            } else {
                alert('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„æ´»åŠ¨ã€‚');
                console.error('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„æ´»åŠ¨ï¼ŒID:', id);
            }
        }

        // Function to handle delete activity button click (New Function)
        function deleteActivityItem(id) {
              if (confirm('ç¡®å®šè¦åˆ é™¤æ´»åŠ¨IDä¸º ' + id + ' çš„æ´»åŠ¨å—ï¼Ÿ')) {
                  deleteActivityFromBackend(id); // Call the new function to delete from backend
              }
         }

         // Function to delete activity from backend (New Function)
         async function deleteActivityFromBackend(id) {
             try {
                 // å°†ä¼ å…¥çš„å­—ç¬¦ä¸²IDè½¬æ¢ä¸ºæ•´æ•°ï¼Œè™½ç„¶DELETEè¯·æ±‚URLæ˜¯å­—ç¬¦ä¸²ï¼Œä½†ä¸ºäº†é€»è¾‘ä¸€è‡´æ€§
                  const activityIdNum = parseInt(id, 10);
                 // å‘åç«¯å‘é€DELETEè¯·æ±‚
                 const response = await fetch(`http://192.168.31.201:5000/api/activities/${activityIdNum}`, {
                     method: 'DELETE',
                 });

                 const result = await response.json();

                 if (response.ok) {
                     // è¯·æ±‚æˆåŠŸï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å¹¶åˆ·æ–°æ´»åŠ¨åˆ—è¡¨
                     alert(result.message || 'æ´»åŠ¨åˆ é™¤æˆåŠŸï¼');
                     loadActivityData(); // é‡æ–°åŠ è½½æ´»åŠ¨åˆ—è¡¨
                 } else {
                     // è¯·æ±‚å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                     const errorMessage = result.message || 'åˆ é™¤æ´»åŠ¨å¤±è´¥';
                     alert(`åˆ é™¤æ´»åŠ¨å¤±è´¥: ${errorMessage}`);
                     console.error('åˆ é™¤æ´»åŠ¨å¤±è´¥å“åº”:', result);
                 }

             } catch (error) {
                 // ç½‘ç»œæˆ–å…¶ä»–é”™è¯¯
                 console.error('å‘é€åˆ é™¤æ´»åŠ¨è¯·æ±‚æ—¶å‡ºé”™:', error);
                 alert(`åˆ é™¤æ´»åŠ¨å¤±è´¥: ${error.message}`);
             }
         }

         function loadVisitorData() {
             console.log("Loading visitor data (placeholder)");
             // TODO: Implement fetching and displaying visitor data
         }

         // Function to display devices in the table (New Function)
         function displayDeviceStatus(devicesToDisplay) {
             const devicesTableBody = document.getElementById('devicesTableBody');
             if (!devicesTableBody) {
                 console.error('Devices table body not found.');
                 return;
             }
             devicesTableBody.innerHTML = ''; // Clear previous entries

             if (devicesToDisplay.length === 0) {
                 devicesTableBody.innerHTML = '<tr><td colspan="10">æš‚æ— è®¾å¤‡æ•°æ®ã€‚</td></tr>';
                 return;
             }

             devicesToDisplay.forEach(device => {
                 const row = document.createElement('tr');

                  // å¤„ç†çŠ¶æ€é¢œè‰²
                  let statusClass = '';
                  if (device.Status === 'åœ¨çº¿') {
                      statusClass = 'status-online';
                  } else if (device.Status === 'ç¦»çº¿') {
                      statusClass = 'status-offline';
                  } else if (device.Status === 'å‘Šè­¦' || device.AlertLevel === 'High' || device.AlertLevel === 'Medium') {
                      statusClass = 'status-warning';
                  }

                  // å¤„ç†æ›´æ–°æ—¶é—´æ ¼å¼
                  const formatUpdateTime = (datetimeString) => {
                      if (!datetimeString) return '';
                       try {
                          const date = new Date(datetimeString);
                          // å¯ä»¥æ˜¾ç¤ºå¤šä¹…å‰æ›´æ–°ï¼Œæˆ–è€…å…·ä½“çš„æ—¥æœŸæ—¶é—´
                          // ä¾‹å¦‚ï¼šä½¿ç”¨ toLocaleString() æˆ–è€…è‡ªå®šä¹‰æ ¼å¼
                          return date.toLocaleString(); // æ˜¾ç¤ºæœ¬åœ°åŒ–çš„æ—¥æœŸå’Œæ—¶é—´
                       } catch (e) {
                           console.error('Error formatting update time:', datetimeString, e);
                           return datetimeString; // æ ¼å¼åŒ–å¤±è´¥æ—¶è¿”å›åŸå§‹å­—ç¬¦ä¸²
                       }
                  };

                  const updateTimeDisplay = formatUpdateTime(device.UpdateTime);


                 row.innerHTML = `
                     <td>${device.ID || 'N/A'}</td>
                     <td>${device.DeviceID || 'N/A'}</td>
                     <td>${device.DeviceType || 'æœªçŸ¥'}</td>
                     <td>${device.Location || 'æœªçŸ¥'}</td>
                     <td><span class="device-status ${statusClass}">${device.Status || 'æœªçŸ¥'}</span></td>
                     <td>${device.Value || 'N/A'}</td>
                     <td>${device.Battery !== null ? device.Battery : 'N/A'}</td>
                     <td>${device.AlertLevel || 'æ— å‘Šè­¦'}</td>
                     <td>${device.AlertMessage || 'æ— '}</td>
                     <td>${updateTimeDisplay}</td>
                 `;
                 // æ³¨æ„ï¼šè®¾å¤‡ç®¡ç†é¡µé¢ç›®å‰æ²¡æœ‰ç¼–è¾‘å’Œåˆ é™¤æ“ä½œï¼Œæ‰€ä»¥ä¸æ·»åŠ æ“ä½œæŒ‰é’®
                 // å¦‚æœéœ€è¦æ§åˆ¶è®¾å¤‡ï¼Œå¯ä»¥æ·»åŠ æ§åˆ¶æŒ‰é’®å¹¶å®ç°ç›¸åº”å‡½æ•°

                 devicesTableBody.appendChild(row);
             });
         }

        // Initial setup when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
             // Attach event listeners to navigation buttons to call showSection
             document.querySelectorAll('.main-nav .nav-btn').forEach(button => {
                 button.addEventListener('click', () => {
                     // Extract sectionId from the onclick attribute safely
                     const onclickAttr = button.getAttribute('data-target');
                     if (onclickAttr) {
                         showSection(onclickAttr);
                     } else {
                         console.error('Could not extract sectionId from data-target attribute:', onclickAttr);
                         // Fallback to overview if extraction fails for a button
                         showSection('overview');
                     }
                 });
             });

             // Add event listener for the search input in the artifacts section
             const searchInput = document.getElementById('searchInput');
             if (searchInput) {
                 searchInput.addEventListener('input', searchArtifacts);
             }

             // Add event listener to the form's reset event to also reset editing state
             if (artifactForm) {
                  artifactForm.addEventListener('reset', resetArtifactForm);
             }

             // Add event listener to the activity form's reset event to also reset editing state
             if (activityForm) {
                  activityForm.addEventListener('reset', resetActivityForm);
             }

             // Initial data loading for the default active section (already handled by initial showSection call)
             // Any section that is active on load will have its data loading function called by showSection
        });

        // --- æ–°å¢ï¼šæ¨¡æ‹Ÿç”¨æˆ·è§’è‰²æ§åˆ¶å’Œå¯¼èˆªæ˜¾ç¤º --- START

        // Function to set mock user role and update UI
        function setMockUserRole(role) {
            window.currentUserRole = role;
            document.getElementById('currentRoleDisplay').textContent = `å½“å‰è§’è‰²: ${role === 'Normal' ? 'æ™®é€šç”¨æˆ·' : 'ç®¡ç†å‘˜'}`;
            console.log('æ¨¡æ‹Ÿç”¨æˆ·è§’è‰²è®¾ç½®ä¸º:', role);
            updateNavigationVisibility(); // Call function to update navigation
            // Optionally, redirect to overview or home page after changing role
            showSection('overview');
        }

        // Function to update navigation menu visibility based on role
        function updateNavigationVisibility() {
            const navBtns = document.querySelectorAll('.main-nav .nav-btn');
            const normalUserSections = ['overview', 'artifact-info', 'multimedia-interaction', 'community', 'ai-qa']; // æ™®é€šç”¨æˆ·å¯è§çš„ section
            const adminSections = ['overview', 'artifact-management', 'device-management', 'activity-management', 'exhibition-hall-management', 'user-management', 'data-dashboard']; // ç®¡ç†å‘˜å¯è§çš„ section

            navBtns.forEach(btn => {
                const sectionId = btn.getAttribute('data-target');
                let isVisible = false;

                if (window.currentUserRole === 'Normal') {
                    if (normalUserSections.includes(sectionId)) {
                        isVisible = true;
                    }
                } else if (window.currentUserRole === 'Admin') {
                     if (adminSections.includes(sectionId)) {
                         isVisible = true;
                     }
                } else {
                     isVisible = true; // é»˜è®¤æ‰€æœ‰å¯è§
                }

                btn.style.display = isVisible ? '' : 'none';
            });
             const activeBtn = document.querySelector('.main-nav .nav-btn.active');
             if (activeBtn && activeBtn.style.display === 'none'){
                  showSection('overview');
             }
        }

        // Add event listener for DOMContentLoaded to initialize navigation visibility
        document.addEventListener('DOMContentLoaded', () => {
            // ... existing DOMContentLoaded logic ...
            updateNavigationVisibility(); // Call here after initial showSection
        });

        // --- æ–°å¢ï¼šæ¨¡æ‹Ÿç”¨æˆ·è§’è‰²æ§åˆ¶å’Œå¯¼èˆªæ˜¾ç¤º --- END


        // --- å±•å…ç®¡ç†ç›¸å…³çš„JavaScriptå‡½æ•° (æ–°å¢) ---

        // Function to load exhibition hall data from the backend API
        async function loadExhibitionHallData() {
            const exhibitionHallsTableBody = document.getElementById('exhibitionHallsTableBody');
            if (!exhibitionHallsTableBody) {
                console.error('Exhibition halls table body not found.');
                return;
            }
            exhibitionHallsTableBody.innerHTML = '<tr><td colspan="6">åŠ è½½ä¸­...</td></tr>'; // Loading indicator

            try {
                const response = await fetch('http://192.168.31.201:5000/api/exhibition_halls');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const exhibitionHalls = await response.json();

                window.currentExhibitionHalls = exhibitionHalls; // Store exhibition halls data

                displayExhibitionHalls(exhibitionHalls); // Display exhibition halls

                // TODO: Update related stats in overview or exhibition hall management section if any

            } catch (error) {
                console.error('Error loading exhibition halls:', error);
                exhibitionHallsTableBody.innerHTML = `<tr><td colspan="6" style="color: red;">åŠ è½½å±•å…æ•°æ®å¤±è´¥: ${error.message}</td></tr>`;
            }
        }

        // Function to display exhibition halls in the table
        function displayExhibitionHalls(exhibitionHallsToDisplay) {
            const exhibitionHallsTableBody = document.getElementById('exhibitionHallsTableBody');
            if (!exhibitionHallsTableBody) {
                console.error('Exhibition halls table body not found for display.');
                return;
            }
            exhibitionHallsTableBody.innerHTML = ''; // Clear previous entries

            if (exhibitionHallsToDisplay.length === 0) {
                exhibitionHallsTableBody.innerHTML = '<tr><td colspan="6">æš‚æ— å±•å…æ•°æ®ã€‚</td></tr>'; // Update colspan
                return;
            }

            exhibitionHallsToDisplay.forEach(exhibitionHall => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${exhibitionHall.ID || 'N/A'}</td>
                    <td>${exhibitionHall.Name || 'N/A'}</td>
                    <td>${exhibitionHall.Floor || 'æœªçŸ¥'}</td>
                    <td>${exhibitionHall.AreaCode || 'æœªçŸ¥'}</td>
                    <td>${exhibitionHall.ArtifactCount || 0}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="editExhibitionHall('${exhibitionHall.ID}')">ç¼–è¾‘</button>
                        <button class="btn btn-secondary btn-sm" onclick="deleteExhibitionHall('${exhibitionHall.ID}')">åˆ é™¤</button>
                    </td>
                `;
                exhibitionHallsTableBody.appendChild(row);
            });
        }

        // --- å±•å…ç®¡ç†ç›¸å…³çš„JavaScriptå‡½æ•°ç»“æŸ ---

        // --- ç”¨æˆ·è¡Œä¸ºç›¸å…³çš„JavaScriptå‡½æ•° (æ–°å¢) ---

        // Function to load user behavior data from the backend API
        async function loadUserBehaviorData() {
            console.log("Loading user behavior data...");

            const userBehaviorsTableBody = document.getElementById('userBehaviorsTableBody');
             if (!userBehaviorsTableBody) {
                  console.error('User behaviors table body not found.');
                  return;
              }
             userBehaviorsTableBody.innerHTML = '<tr><td colspan="8">åŠ è½½ä¸­...</td></tr>'; // Loading indicator

              try {
                  const response = await fetch('http://192.168.31.201:5000/api/user_behaviors'); // å‡è®¾æ–°çš„æ¥å£ /api/user_behaviors
                  if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                  }
                  const behaviors = await response.json();

                  window.currentUserBehaviors = behaviors; // Store user behaviors globally

                  // Call display functions for relevant sections if they are active
                  const activeSectionId = document.querySelector('.section.active').id;
                   if (activeSectionId === 'data-dashboard') {
                       displayUserBehaviorData(); // Display in dashboard table
                   } else if (activeSectionId === 'community') {
                       displayCommunityPosts(); // Display in community list
                   }

              } catch (error) {
                  console.error('Error loading user behaviors:', error);
                  userBehaviorsTableBody.innerHTML = `<tr><td colspan="8" style="color: red;">åŠ è½½ç”¨æˆ·è¡Œä¸ºæ•°æ®å¤±è´¥: ${error.message}</td></tr>`;
              }
        }

        // Function to display user behavior items in the table (New Function)
        function displayUserBehaviorData() { // Removed parameter, will use global data
             const userBehaviorsTableBody = document.getElementById('userBehaviorsTableBody');
              if (!userBehaviorsTableBody) {
                   console.error('User behaviors table body not found for display.');
                   return;
               }
             userBehaviorsTableBody.innerHTML = ''; // Clear previous entries

             const allBehaviors = window.currentUserBehaviors || []; // Use global data

             if (allBehaviors.length === 0) {
                 userBehaviorsTableBody.innerHTML = '<tr><td colspan="8">æš‚æ— ç”¨æˆ·è¡Œä¸ºæ•°æ®ã€‚</td></tr>'; // Update colspan
                 return;
             }

              const artifactMap = {};
              // æ„å»ºæ–‡ç‰©IDåˆ°åç§°çš„æ˜ å°„ï¼Œä»¥ä¾¿åœ¨è¡Œä¸ºåˆ—è¡¨ä¸­æ˜¾ç¤ºæ–‡ç‰©åç§° (å¦‚æœæ–‡ç‰©æ•°æ®å·²åŠ è½½)
              if (window.currentArtifacts) {
                  window.currentArtifacts.forEach(artifact => {
                      artifactMap[artifact.ID] = artifact.Name;
                  });
              }

             allBehaviors.forEach(item => { // Iterate over global data
                 const row = document.createElement('tr');

                  // å¤„ç† datetime æ ¼å¼
                   const formatDateTime = (datetimeString) => {
                        if (!datetimeString) return '';
                        try {
                            const date = new Date(datetimeString);
                            return date.toLocaleString();
                         } catch (e) {
                             return datetimeString;
                         }
                    };
                  const createTimeDisplay = formatDateTime(item.CreateTime);

                  // æ ¹æ® ArtifactID æŸ¥æ‰¾æ–‡ç‰©åç§°
                  const artifactName = item.ArtifactID !== null && artifactMap[item.ArtifactID] ? artifactMap[item.ArtifactID] : 'æ— å…³è”æ–‡ç‰©';

                 row.innerHTML = `
                     <td>${item.ID || 'N/A'}</td>
                     <td>${item.UserID || 'åŒ¿å'}</td>
                     <td>${artifactName}</td>
                     <td>${item.BehaviorType || 'æœªçŸ¥'}</td>
                     <td>${item.Duration !== null ? item.Duration : 'N/A'}</td>
                     <td>${item.Content || ''}</td>
                     <td>${item.Location || 'æœªçŸ¥'}</td>
                     <td>${createTimeDisplay}</td>
                 `;
                 // ç”¨æˆ·è¡Œä¸ºé€šå¸¸åªæœ‰æŸ¥çœ‹ï¼Œæ²¡æœ‰ç¼–è¾‘åˆ é™¤æ“ä½œï¼Œæ‰€ä»¥ä¸æ·»åŠ æ“ä½œæŒ‰é’®

                 userBehaviorsTableBody.appendChild(row);
             });
         }

        // --- ç”¨æˆ·è¡Œä¸ºç›¸å…³çš„JavaScriptå‡½æ•°ç»“æŸ ---

        // --- ç”¨æˆ·ç®¡ç†ç›¸å…³çš„JavaScriptå‡½æ•° (æ–°å¢) ---

        // Function to load user data from the backend API
        async function loadUserData() {
            console.log("Loading user data...");

            const usersTableBody = document.getElementById('usersTableBody');
             if (!usersTableBody) {
                  console.error('Users table body not found.');
                  return;
              }
             usersTableBody.innerHTML = '<tr><td colspan="10">åŠ è½½ä¸­...</td></tr>'; // Update colspan

              try {
                  const response = await fetch('http://192.168.31.201:5000/api/users'); // å‡è®¾æ–°çš„æ¥å£ /api/users
                  if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                  }
                  const users = await response.json();

                  window.currentUsers = users; // å­˜å‚¨ç”¨æˆ·æ•°æ®

                  displayUsers(users); // æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨

                  // TODO: Update related stats in overview or user management section if any

              } catch (error) {
                  console.error('Error loading users:', error);
                  usersTableBody.innerHTML = `<tr><td colspan="10" style="color: red;">åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥: ${error.message}</td></tr>`; // Update colspan
              }
        }

        // Function to display user items in the table (New Function)
        function displayUsers(usersToDisplay) {
            const usersTableBody = document.getElementById('usersTableBody');
             if (!usersTableBody) {
                  console.error('Users table body not found for display.');
                  return;
              }
            usersTableBody.innerHTML = ''; // Clear previous entries

            if (usersToDisplay.length === 0) {
                usersTableBody.innerHTML = '<tr><td colspan="10">æš‚æ— ç”¨æˆ·æ•°æ®ã€‚</td></tr>'; // Update colspan
                return;
            }

            usersToDisplay.forEach(item => {
                const row = document.createElement('tr');

                 // å¤„ç† datetime æ ¼å¼
                  const formatDateTime = (datetimeString) => {
                       if (!datetimeString) return '';
                       try {
                           const date = new Date(datetimeString);
                           return date.toLocaleString();
                        } catch (e) {
                            return datetimeString;
                        }
                   };
                 const createTimeDisplay = formatDateTime(item.CreateTime);
                 const lastLoginTimeDisplay = formatDateTime(item.LastLoginTime);

                row.innerHTML = `
                    <td>${item.ID || 'N/A'}</td>
                    <td>${item.OpenID || 'N/A'}</td>
                    <td>${item.Nickname || 'åŒ¿åç”¨æˆ·'}</td>
                    <td><img src="${item.AvatarURL || ''}" alt="Avatar" width="30" height="30"></td>
                    <td>${item.Gender || 'æœªçŸ¥'}</td>
                    <td>${item.AgeGroup || 'æœªçŸ¥'}</td>
                    <td>${item.VisitCount || 0}</td>
                    <td>${item.FavoriteCount || 0}</td>
                    <td>${item.Role || 'æ™®é€šç”¨æˆ·'}</td>
                    <td>${createTimeDisplay}</td>
                    <td>${lastLoginTimeDisplay}</td>
                    <td>
                         <button class="btn btn-secondary btn-sm" onclick="editUser('${item.ID}')">ç¼–è¾‘</button>
                         <button class="btn btn-secondary btn-sm" onclick="deleteUser('${item.ID}')">åˆ é™¤</button>
                    </td>
                `;
                usersTableBody.appendChild(row);
            });
        }

        // --- ç”¨æˆ·ç®¡ç†ç›¸å…³çš„JavaScriptå‡½æ•°ç»“æŸ ---

        // Function to handle delete user button click
        async function deleteUser(id) {
             if (confirm('ç¡®å®šè¦åˆ é™¤ç”¨æˆ·IDä¸º ' + id + ' çš„ç”¨æˆ·å—ï¼Ÿ')) {
                 try {
                     // å‘åç«¯å‘é€DELETEè¯·æ±‚
                     const response = await fetch(`http://192.168.31.201:5000/api/users/${id}`, {
                         method: 'DELETE',
                     });

                     const result = await response.json();

                     if (response.ok) {
                         // è¯·æ±‚æˆåŠŸï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å¹¶åˆ·æ–°ç”¨æˆ·åˆ—è¡¨
                         alert(result.message || 'ç”¨æˆ·åˆ é™¤æˆåŠŸï¼');
                         loadUserData(); // é‡æ–°åŠ è½½ç”¨æˆ·åˆ—è¡¨
                     } else {
                         // è¯·æ±‚å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                         const errorMessage = result.message || 'åˆ é™¤ç”¨æˆ·å¤±è´¥';
                         alert(`åˆ é™¤ç”¨æˆ·å¤±è´¥: ${errorMessage}`);
                         console.error('åˆ é™¤ç”¨æˆ·å¤±è´¥å“åº”:', result);
                     }

                 } catch (error) {
                     // ç½‘ç»œæˆ–å…¶ä»–é”™è¯¯
                     console.error('å‘é€åˆ é™¤ç”¨æˆ·è¯·æ±‚æ—¶å‡ºé”™:', error);
                     alert(`åˆ é™¤ç”¨æˆ·å¤±è´¥: ${error.message}`);
                 }
             }
        }

        // Note: editUser function is placeholder as per user request to skip edit functionality
        function editUser(id) {
             console.log("Edit User function (placeholder) for ID:", id);
             alert('ç¼–è¾‘ç”¨æˆ·åŠŸèƒ½å¾…å®ç°'); // Placeholder alert
             // TODO: Implement edit logic if needed later
        }

        // --- ç”¨æˆ·ç®¡ç†ç›¸å…³çš„JavaScriptå‡½æ•° (æ–°å¢) ---

        // Function to handle adding or updating a user
        const userForm = document.getElementById('addUserForm'); // Assume the form will have this ID
        const userSubmitButton = userForm ? userForm.querySelector('button[type="submit"]') : null; // Assume the form has a submit button

        if (userForm && userSubmitButton) {
            userForm.addEventListener('submit', async function(event) {
                event.preventDefault(); // Prevent default form submission

                // æ”¶é›†è¡¨å•æ•°æ®
                const userData = {
                    OpenID: document.getElementById('userOpenID').value || null,
                    Nickname: document.getElementById('userNickname').value || null,
                    AvatarURL: document.getElementById('userAvatarURL').value || null,
                    Gender: document.getElementById('userGender').value || null,
                    AgeGroup: document.getElementById('userAgeGroup').value || null,
                    Role: document.getElementById('userRole').value || null,
                    // VisitCount, FavoriteCount, CreateTime, LastLoginTime, ID é€šå¸¸ç”±åç«¯å¤„ç†æˆ–ä¸éœ€è¦å‰ç«¯æäº¤
                };

                console.log('æäº¤çš„ç”¨æˆ·æ•°æ®:', userData);

                let url;
                let method;
                let successMessage;
                let errorMessage;

                // åˆ¤æ–­æ˜¯æ·»åŠ è¿˜æ˜¯ç¼–è¾‘æ¨¡å¼
                if (window.editingUserId) {
                    // ç¼–è¾‘æ¨¡å¼ (æš‚æ—¶ä¸éœ€è¦ï¼Œä½†ä¿ç•™ç»“æ„)
                    url = `http://192.168.31.201:5000/api/users/${window.editingUserId}`;
                    method = 'PUT';
                    successMessage = 'ç”¨æˆ·æ›´æ–°æˆåŠŸï¼';
                    errorMessage = 'æ›´æ–°ç”¨æˆ·å¤±è´¥';
                } else {
                    // æ·»åŠ æ¨¡å¼
                    url = 'http://192.168.31.201:5000/api/users';
                    method = 'POST';
                    successMessage = 'ç”¨æˆ·æ·»åŠ æˆåŠŸï¼';
                    errorMessage = 'æ·»åŠ ç”¨æˆ·å¤±è´¥';
                }

                try {
                    // å‘åç«¯å‘é€è¯·æ±‚
                    const response = await fetch(url, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(userData),
                    });

                    const result = await response.json();

                    if (response.ok) {
                        // è¯·æ±‚æˆåŠŸï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼Œæ¸…ç©ºè¡¨å•ï¼Œå¹¶åˆ·æ–°ç”¨æˆ·åˆ—è¡¨
                        alert(result.message || successMessage);
                        userForm.reset();
                        resetUserForm(); // é‡ç½®è¡¨å•åˆ°æ·»åŠ æ¨¡å¼çŠ¶æ€
                        loadUserData(); // é‡æ–°åŠ è½½ç”¨æˆ·åˆ—è¡¨
                    } else {
                        // è¯·æ±‚å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                        const msg = result.message || errorMessage;
                        alert(`${errorMessage}: ${msg}`);
                        console.error(`${errorMessage}å“åº”:`, result);
                    }

                } catch (error) {
                    // ç½‘ç»œæˆ–å…¶ä»–é”™è¯¯
                    console.error(`å‘é€${method}ç”¨æˆ·è¯·æ±‚æ—¶å‡ºé”™:`, error);
                    alert(`${errorMessage}: ${error.message}`);
                }
            });
        }

        // Function to reset the user form to add mode
        function resetUserForm() {
            window.editingUserId = null;
            const submitButton = document.querySelector('#addUserForm button[type="submit"]');
            if (submitButton) {
                submitButton.textContent = 'æ·»åŠ ç”¨æˆ·';
            }
            // æ¸…ç©ºè¡¨å•ï¼ˆç”± form.reset() å¤„ç†ï¼‰
        }

        // Function to display artifacts in the audience view (New Function)
        function displayArtifactsForAudience(artifactsToDisplay) {
            const audienceArtifactListDiv = document.getElementById('audienceArtifactList');
            if (!audienceArtifactListDiv) {
                console.error('Audience artifact list div not found.');
                return;
            }
            audienceArtifactListDiv.innerHTML = ''; // Clear previous entries

            if (artifactsToDisplay.length === 0) {
                audienceArtifactListDiv.innerHTML = '<p>æš‚æ— æ–‡ç‰©æ•°æ®ã€‚</p>';
                return;
            }

            // Create a grid container for cards (optional, based on desired layout)
            const cardGrid = document.createElement('div');
            cardGrid.classList.add('card-grid'); // Reuse existing card-grid style

            artifactsToDisplay.forEach(artifact => {
                const artifactCard = document.createElement('div');
                artifactCard.classList.add('card'); // Reuse existing card style
                artifactCard.style.marginBottom = '20px'; // Add some spacing

                // Basic card content - you can expand this with more details
                artifactCard.innerHTML = `
                    <h3>${artifact.Name || 'æœªçŸ¥æ–‡ç‰©'}</h3>
                    ${artifact.ImageURL ? `<img src="${artifact.ImageURL}" alt="${artifact.Name || 'æ–‡ç‰©å›¾ç‰‡'}" style="max-width: 100%; height: auto; margin-bottom: 15px; border-radius: 8px;">` : ''}
                    <p><strong>å¹´ä»£:</strong> ${artifact.Era || 'æœªçŸ¥'}</p>
                    <p><strong>åˆ†ç±»:</strong> ${artifact.Category || 'æœªçŸ¥'}</p>
                    <p><strong>ä½ç½®:</strong> ${artifact.Location || 'æœªçŸ¥'}</p>
                    <p style="margin-top: 10px;">${artifact.Description || 'æš‚æ— æè¿°'}</p>
                    <!-- å¯ä»¥æ·»åŠ æ›´å¤šè¯¦æƒ…ã€å¯¼è§ˆã€è¯­éŸ³è®²è§£æŒ‰é’®ç­‰ -->
                `;
                cardGrid.appendChild(artifactCard);
            });

            audienceArtifactListDiv.appendChild(cardGrid); // Append the grid to the section container

            // Add click event listener to each artifact card using event delegation on the grid container
            cardGrid.addEventListener('click', function(event) {
                const clickedCard = event.target.closest('.card');
                if (clickedCard) {
                    const artifactId = clickedCard.dataset.artifactId;
                    if (artifactId) {
                        showArtifactDetails(artifactId); // Call the function to show details
                    }
                }
            });
        }

        // Placeholder function to show artifact details (New Function)
        function showArtifactDetails(artifactId) {
            console.log('Showing details for artifact ID:', artifactId);
            // Find the artifact in the loaded list
            const artifact = window.currentArtifacts.find(art => String(art.ID) === String(artifactId));
             if (artifact) {
                 // Display details in the dedicated details area
                 displaySingleArtifactDetails(artifact);
                 // Switch view from list to details
                 showArtifactDetailSection();
             } else {
                 alert('æœªæ‰¾åˆ°è¯¥æ–‡ç‰©è¯¦æƒ…ã€‚');
             }
        }

        // Function to display a single artifact's details in the details section (New Function)
        function displaySingleArtifactDetails(artifact) {
            const detailsSection = document.getElementById('artifact-details');
            if (!detailsSection) {
                console.error('Artifact details section not found.');
                return;
            }

            // Clear previous content
            detailsSection.innerHTML = '';

            // Add content for the single artifact details
            detailsSection.innerHTML = `
                <h2>${artifact.Name || 'æœªçŸ¥æ–‡ç‰©'} è¯¦æƒ…</h2>
                <button class="btn btn-secondary btn-sm" onclick="hideArtifactDetailSection()">è¿”å›åˆ—è¡¨</button>
                <div class="card" style="margin-top: 20px;">
                    ${artifact.ImageURL ? `<img src="${artifact.ImageURL}" alt="${artifact.Name || 'æ–‡ç‰©å›¾ç‰‡'}" style="max-width: 100%; height: auto; margin-bottom: 15px; border-radius: 8px;">` : ''}
                    <p><strong>ID:</strong> ${artifact.ID || 'N/A'}</p>
                    <p><strong>åˆ†ç±»:</strong> ${artifact.Category || 'æœªçŸ¥'}</p>
                    <p><strong>å¹´ä»£:</strong> ${artifact.Era || 'æœªçŸ¥'}</p>
                    <p><strong>ä½ç½®:</strong> ${artifact.Location || 'æœªçŸ¥'}</p>
                    <p><strong>æµè§ˆæ¬¡æ•°:</strong> ${artifact.ViewCount || 0}</p>
                    <p style="margin-top: 10px;"><strong>æè¿°:</strong> ${artifact.Description || 'æš‚æ— æè¿°'}</p>
                    <!-- å¯ä»¥æ·»åŠ éŸ³é¢‘ã€è§†é¢‘ã€3Dæ¨¡å‹é“¾æ¥ç­‰ -->
                    ${artifact.AudioURL ? `<p><strong>éŸ³é¢‘å¯¼è§ˆ:</strong> <a href="${artifact.AudioURL}" target="_blank">æ”¶å¬</a></p>` : ''}
                    ${artifact.VideoURL ? `<p><strong>è§†é¢‘ä»‹ç»:</strong> <a href="${artifact.VideoURL}" target="_blank">è§‚çœ‹</a></p>` : ''}
                </div>
                 <!-- TODO: Add more details, related artifacts, comments section etc. -->
            `;
        }

        // Function to show the artifact details section and hide the list (New Function)
        function showArtifactDetailSection() {
            const audienceArtifactListDiv = document.getElementById('audienceArtifactList');
            const detailsSection = document.getElementById('artifact-details');

            if (audienceArtifactListDiv) audienceArtifactListDiv.style.display = 'none';
            if (detailsSection) detailsSection.style.display = 'block'; // Show the details section
        }

        // Function to hide the artifact details section and show the list (New Function)
        function hideArtifactDetailSection() {
             const audienceArtifactListDiv = document.getElementById('audienceArtifactList');
             const detailsSection = document.getElementById('artifact-details');

             if (detailsSection) detailsSection.style.display = 'none'; // Hide the details section
             if (audienceArtifactListDiv) audienceArtifactListDiv.style.display = 'block'; // Show the list section

             // Optional: Reload the list to reflect any potential changes (e.g., view count increment)
             // loadArtifacts(); // May not be necessary if view count is updated asynchronously or not critical to see immediately
        }

        // Function to display multimedia content (New Function)
        function displayMultimediaContent(artifacts, halls) {
            console.log("Displaying multimedia content...");

            const multimediaArtifactListDiv = document.getElementById('multimediaArtifactList');
            const panoramaViewDiv = document.getElementById('panoramaView');

            if (!multimediaArtifactListDiv || !panoramaViewDiv) {
                console.error('Multimedia display areas not found.');
                return;
            }

            // --- Display Multimedia Artifacts ---
            multimediaArtifactListDiv.innerHTML = ''; // Clear previous entries

            const multimediaArtifacts = artifacts.filter(artifact => artifact.AudioURL || artifact.VideoURL);

            if (multimediaArtifacts.length === 0) {
                multimediaArtifactListDiv.innerHTML = '<p>æš‚æ— å¸¦æœ‰éŸ³é¢‘æˆ–è§†é¢‘çš„æ–‡ç‰©ã€‚</p>';
            } else {
                const list = document.createElement('ul');
                list.style.listStyle = 'none';
                list.style.padding = '0';

                multimediaArtifacts.forEach(artifact => {
                    const listItem = document.createElement('li');
                    listItem.style.marginBottom = '15px';
                    listItem.style.padding = '15px';
                    listItem.style.borderBottom = '1px solid #eee';
                    listItem.innerHTML = `
                        <h4>${artifact.Name || 'æœªçŸ¥æ–‡ç‰©'}</h4>
                        ${artifact.AudioURL ? `<p>éŸ³é¢‘å¯¼è§ˆ:<br><audio controls><source src="${artifact.AudioURL}" type="audio/mpeg">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚</audio></p>` : ''}
                        ${artifact.VideoURL ? `<p>è§†é¢‘ä»‹ç»:<br><video controls style="max-width: 100%; height: auto;"><source src="${artifact.VideoURL}" type="video/mp4">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚</video></p>` : ''}
                        <!-- å¯ä»¥åµŒå…¥éŸ³é¢‘/è§†é¢‘æ’­æ”¾å™¨ï¼Œæˆ–è€…æä¾›é“¾æ¥ -->
                    `;
                    list.appendChild(listItem);
                });
                multimediaArtifactListDiv.appendChild(list);
            }

            // --- Display Panorama View ---
            panoramaViewDiv.innerHTML = ''; // Clear previous entries

            // Find the first hall with a panorama URL
            const hallWithPanorama = halls.find(hall => hall.PanoramaURL);

            if (hallWithPanorama && hallWithPanorama.PanoramaURL) {
                // Option 1: Display a link to the panorama
                panoramaViewDiv.innerHTML = `
                    <p>æ¢ç´¢å±•å…å…¨æ™¯: <a href="${hallWithPanorama.PanoramaURL}" target="_blank">${hallWithPanorama.Name || 'æœªçŸ¥å±•å…'} å…¨æ™¯</a></p>
                `;
                // Option 2: Embed the panorama using an iframe (might have cross-origin issues or require specific viewers)
                // If using a dedicated panorama viewer library, initialize it here.
                // Example iframe (may not work with all URLs):
                /*
                panoramaViewDiv.innerHTML = `
                    <iframe src="${hallWithPanorama.PanoramaURL}" style="width: 100%; height: 400px; border: none;"></iframe>
                `;
                */

            } else {
                panoramaViewDiv.innerHTML = '<p>æš‚æ— å±•å…å…¨æ™¯å¯ç”¨ã€‚</p>';
            }
        }

        // --- æ–‡ç‰©è¯¦æƒ…ç›¸å…³çš„JavaScriptå‡½æ•°ç»“æŸ ---

        // --- äº’åŠ¨ç¤¾åŒºç›¸å…³çš„JavaScriptå‡½æ•° (æ–°å¢) ---

        // Function to populate artifact select dropdown for Community form (New Function)
        function loadArtifactOptionsForCommunity() {
            const artifactSelect = document.getElementById('experienceArtifact');
             if (!artifactSelect) {
                  console.error('Artifact select for Community not found.');
                  return;
              }
              // ä½¿ç”¨å·²åŠ è½½çš„æ–‡ç‰©æ•°æ®å¡«å……ä¸‹æ‹‰èœå•
              const artifacts = window.currentArtifacts || [];
              // Clear existing options except the default
              artifactSelect.innerHTML = '<option value="">-- é€‰æ‹©æ–‡ç‰© --</option>';

              artifacts.forEach(artifact => {
                  const option = document.createElement('option');
                  option.value = artifact.ID; // Use artifact ID as value
                  option.textContent = artifact.Name; // Use artifact Name as text
                  artifactSelect.appendChild(option);
              });
        }

        // Function to handle submitting a new community post (New Function)
        const shareExperienceForm = document.getElementById('shareExperienceForm');
        if (shareExperienceForm) {
            shareExperienceForm.addEventListener('submit', async function(event) {
                event.preventDefault();

                // æ”¶é›†è¡¨å•æ•°æ®
                const postData = {
                    Content: document.getElementById('experienceContent').value,
                    ArtifactID: document.getElementById('experienceArtifact').value || null, // Get selected artifact ID, use null if none selected
                    BehaviorType: 'CommunityPost', // Specify the type as community post
                    // UserID, CreateTime, Location, Duration etc. will be handled by backend or are not applicable here
                };

                console.log('æäº¤çš„å¿ƒå¾—æ•°æ®:', postData);

                try {
                    // å‘åç«¯å‘é€POSTè¯·æ±‚åˆ°ç”¨æˆ·è¡Œä¸ºæ¥å£
                    const response = await fetch('http://192.168.31.201:5000/api/user_behaviors', { // Assuming the endpoint is /api/user_behaviors
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(postData),
                    });

                    const result = await response.json();

                    if (response.ok) {
                        alert(result.message || 'å¿ƒå¾—åˆ†äº«æˆåŠŸï¼');
                        shareExperienceForm.reset(); // æ¸…ç©ºè¡¨å•
                        // After submitting, reload all user behaviors and re-display both dashboard and community views
                        await loadUserBehaviorData(); // Reload user behaviors
                        // displayCommunityPosts is called within loadUserBehaviorData
                    } else {
                        const msg = result.message || 'åˆ†äº«å¿ƒå¾—å¤±è´¥';
                        alert(`åˆ†äº«å¿ƒå¾—å¤±è´¥: ${msg}`);
                        console.error('åˆ†äº«å¿ƒå¾—å¤±è´¥å“åº”:', result);
                    }

                } catch (error) {
                    console.error('å‘é€åˆ†äº«å¿ƒå¾—è¯·æ±‚æ—¶å‡ºé”™:', error);
                    alert(`åˆ†äº«å¿ƒå¾—å¤±è´¥: ${error.message}`);
                }
            });
        }

        // Function to display community posts (New Function)
        function displayCommunityPosts() { // Removed parameter, will use global data
            console.log("Displaying community posts...");

            const communityPostsListDiv = document.getElementById('communityPostsList');
             if (!communityPostsListDiv) {
                  console.error('Community posts list div not found.');
                  return;
              }
            communityPostsListDiv.innerHTML = ''; // Clear previous entries

            // Filter for behaviors with BehaviorType === 'CommunityPost' from the global data
            const allBehaviors = window.currentUserBehaviors || []; // Use global data
            const communityPosts = allBehaviors.filter(item => item.BehaviorType === 'CommunityPost');

            if (communityPosts.length === 0) {
                communityPostsListDiv.innerHTML = '<p>æš‚æ— ç”¨æˆ·å¿ƒå¾—ã€‚</p>';
                return;
            }

             // Build artifact name map for displaying associated artifact
             const artifactMap = {};
             if (window.currentArtifacts) {
                 window.currentArtifacts.forEach(artifact => {
                     artifactMap[artifact.ID] = artifact.Name;
                 });
             }

            communityPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.classList.add('card'); // Reuse card style
                postElement.style.marginBottom = '15px';

                 // Find associated artifact name if ArtifactID exists
                 const associatedArtifactName = post.ArtifactID !== null && artifactMap[post.ArtifactID] ? ` (å…³è”æ–‡ç‰©: ${artifactMap[post.ArtifactID]})` : '';

                postElement.innerHTML = `
                    <p><strong>ç”¨æˆ· (ID: ${post.UserID || 'æœªçŸ¥'}):</strong> ${post.Content || 'æ— å†…å®¹'}</p>
                    <small style="color: #666;">åˆ†äº«æ—¶é—´: ${post.CreateTime ? new Date(post.CreateTime).toLocaleString() : 'æœªçŸ¥'}${associatedArtifactName}</small>
                    <!-- TODO: å¯ä»¥æ·»åŠ ç‚¹èµ/è¯„è®ºåŠŸèƒ½ -->
                `;
                communityPostsListDiv.appendChild(postElement);
            });
        }

        // --- äº’åŠ¨ç¤¾åŒºç›¸å…³çš„JavaScriptå‡½æ•°ç»“æŸ ---

        // --- é—®ç­”ç®¡ç†ç›¸å…³çš„JavaScriptå‡½æ•° (æ–°å¢) ---
        // Function to load QA data from the backend API
        async function loadQAData() {
            console.log("Loading QA data...");

            const qaListDiv = document.getElementById('qaList');
             if (!qaListDiv) {
                  console.error('QA list div not found.');
                  return;
              }
              qaListDiv.innerHTML = '<p>åŠ è½½ä¸­...</p>'; // Loading indicator

              try {
                  const response = await fetch('http://192.168.31.201:5000/api/qa');
                  if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                  }
                  const qaItems = await response.json();

                  displayQAItems(qaItems); // æ˜¾ç¤ºé—®ç­”åˆ—è¡¨

              } catch (error) {
                  console.error('Error loading QA data:', error);
                  qaListDiv.innerHTML = `<p style="color: red;">åŠ è½½é—®ç­”æ•°æ®å¤±è´¥: ${error.message}</p>`;
              }
        }

        // Function to display QA items (New Function)
        function displayQAItems(qaItemsToDisplay) {
            const qaListDiv = document.getElementById('qaList');
            if (!qaListDiv) { // Redundant check, but good practice
                 console.error('QA list div not found for display.');
                 return;
            }
            qaListDiv.innerHTML = ''; // Clear previous entries

            if (qaItemsToDisplay.length === 0) {
                qaListDiv.innerHTML = '<p>æš‚æ— å…¬å¼€é—®ç­”æ•°æ®ã€‚</p>';
                return;
            }

            qaItemsToDisplay.forEach(item => {
                const qaElement = document.createElement('div');
                qaElement.classList.add('card'); // Use card style for each QA item
                qaElement.style.marginBottom = '15px';
                // æ ¹æ®å›ç­”ç±»å‹æ˜¾ç¤ºä¸åŒçš„å‰ç¼€æˆ–æ ·å¼
                const answerPrefix = item.AnswerType === 'AI' ? 'ğŸ¤– AI å›ç­”:' : (item.AnswerType === 'Human' ? 'ğŸ‘¤ ç®¡ç†å‘˜å›å¤:' : 'ç­”:');
                const answerStyle = item.AnswerType === 'AI' ? 'font-style: italic; color: #007bff;' : ''; // AIå›ç­”å¯èƒ½ç”¨æ–œä½“æˆ–ä¸åŒé¢œè‰²

                qaElement.innerHTML = `
                    <p><strong>é—®:</strong> ${item.Question || ''}</p>
                    <p><strong style="${answerStyle}">${answerPrefix}</strong> ${item.Answer || 'æš‚æ— å›ç­”'}</p>
                    <small style="color: #666;">æé—®æ—¶é—´: ${item.CreateTime ? new Date(item.CreateTime).toLocaleString() : 'æœªçŸ¥'} ${item.AnswerTime ? ' | å›ç­”æ—¶é—´: ' + new Date(item.AnswerTime).toLocaleString() : ''} | èµ: ${item.LikeCount || 0}</small>
                    <!-- å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ ç¼–è¾‘/åˆ é™¤æŒ‰é’®ç­‰ç®¡ç†åŠŸèƒ½ -->
                `;

                // Add answer form if the question has no answer yet
                if (!item.Answer || item.Answer.trim() === '') {
                    qaElement.innerHTML += `
                        <div class="answer-form" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                            <textarea class="form-control answer-input" rows="2" placeholder="è¾“å…¥æ‚¨çš„å›ç­”..."></textarea>
                            <button class="btn btn-secondary btn-sm answer-submit-btn" data-qa-id="${item.ID}" style="margin-top: 10px;">æäº¤å›ç­”</button>
                        </div>
                    `;
                }

                qaListDiv.appendChild(qaElement);
            });

            // Add event listener for submit buttons using event delegation
            qaListDiv.addEventListener('click', async function(event) {
                const targetButton = event.target.closest('.answer-submit-btn');
                if (targetButton) {
                    const qaId = targetButton.dataset.qaId;
                    const answerInput = targetButton.parentElement.querySelector('.answer-input');
                    const answerContent = answerInput.value.trim();

                    if (answerContent) {
                        // Disable button and input while submitting
                        targetButton.disabled = true;
                        answerInput.disabled = true;
                        targetButton.textContent = 'æäº¤ä¸­...';

                        try {
                            const response = await fetch(`http://192.168.31.201:5000/api/qa/${qaId}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ Answer: answerContent }),
                            });

                            const result = await response.json();

                            if (response.ok) {
                                alert(result.message || 'å›ç­”æäº¤æˆåŠŸï¼');
                                // Refresh the QA list to show the new answer
                                loadQAData();
                            } else {
                                const msg = result.message || 'æäº¤å›ç­”å¤±è´¥';
                                alert(`æäº¤å›ç­”å¤±è´¥: ${msg}`);
                                console.error('æäº¤å›ç­”å¤±è´¥å“åº”:', result);
                                // Re-enable button and input on failure
                                targetButton.disabled = false;
                                answerInput.disabled = false;
                                targetButton.textContent = 'æäº¤å›ç­”';
                            }
                        } catch (error) {
                            console.error('å‘é€æäº¤å›ç­”è¯·æ±‚æ—¶å‡ºé”™:', error);
                            alert(`æäº¤å›ç­”å¤±è´¥: ${error.message}`);
                            // Re-enable button and input on failure
                            targetButton.disabled = false;
                            answerInput.disabled = false;
                            targetButton.textContent = 'æäº¤å›ç­”';
                        }
                    } else {
                        alert('è¯·è¾“å…¥å›ç­”å†…å®¹ï¼');
                    }
                }
            });
        }

         // Function to populate artifact select dropdown for QA form (New Function)
         function loadArtifactOptionsForQA() {
             const artifactSelect = document.getElementById('questionArtifact');
              if (!artifactSelect) {
                   console.error('Artifact select for QA not found.');
                   return;
               }
               // ä½¿ç”¨å·²åŠ è½½çš„æ–‡ç‰©æ•°æ®å¡«å……ä¸‹æ‹‰èœå•
               const artifacts = window.currentArtifacts || [];
               // Clear existing options except the default
               artifactSelect.innerHTML = '<option value="">-- é€‰æ‹©æ–‡ç‰© --</option>';

               artifacts.forEach(artifact => {
                   const option = document.createElement('option');
                   option.value = artifact.ID; // Use artifact ID as value
                   option.textContent = artifact.Name; // Use artifact Name as text
                   artifactSelect.appendChild(option);
               });
         }

         // Function to handle submitting a new question (New Function)
         const askQuestionForm = document.getElementById('askQuestionForm');
          if (askQuestionForm) {
              askQuestionForm.addEventListener('submit', async function(event) {
                  event.preventDefault();

                  const questionData = {
                      Question: document.getElementById('questionText').value,
                      ArtifactID: document.getElementById('questionArtifact').value || null, // Get selected artifact ID, use null if none selected
                      // UserID, CreateTime, IsPublic, LikeCount, Answer, AnswerType, AnswerTime will be handled by backend
                  };

                   console.log('æäº¤çš„é—®é¢˜æ•°æ®:', questionData);

                  try {
                      const response = await fetch('http://192.168.31.201:5000/api/qa', {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json',
                          },
                          body: JSON.stringify(questionData),
                      });

                      const result = await response.json();

                      if (response.ok) {
                          alert(result.message || 'é—®é¢˜æäº¤æˆåŠŸï¼è¯·ç­‰å¾…ç®¡ç†å‘˜å›å¤ã€‚');
                          askQuestionForm.reset(); // æ¸…ç©ºè¡¨å•
                          // å¯ä»¥é€‰æ‹©æ˜¯å¦åˆ·æ–°é—®ç­”åˆ—è¡¨ï¼Œæ–°æäº¤çš„é—®é¢˜é»˜è®¤å¯èƒ½ä¸æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥ä¸ç«‹å³åˆ·æ–°
                          loadQAData(); // åœ¨æˆåŠŸæäº¤ååˆ·æ–°åˆ—è¡¨ä»¥æ˜¾ç¤ºæ–°é—®é¢˜
                      } else {
                          const msg = result.message || 'æäº¤é—®é¢˜å¤±è´¥';
                          alert(`æäº¤é—®é¢˜å¤±è´¥: ${msg}`);
                          console.error('æäº¤é—®é¢˜å¤±è´¥å“åº”:', result);
                      }

                  } catch (error) {
                      console.error('å‘é€æäº¤é—®é¢˜è¯·æ±‚æ—¶å‡ºé”™:', error);
                      alert(`æäº¤é—®é¢˜å¤±è´¥: ${error.message}`);
                  }
              });
          }
        // --- é—®ç­”ç®¡ç†ç›¸å…³çš„JavaScriptå‡½æ•°ç»“æŸ ---

        // Function to display latest activities in the overview section (New Function)
        function displayLatestActivities() { // Use global currentActivities data
            console.log("Displaying latest activities...");

            const latestActivitiesListDiv = document.getElementById('latestActivitiesList');
             if (!latestActivitiesListDiv) {
                  console.error('Latest activities list div not found.');
                  return;
              }
            latestActivitiesListDiv.innerHTML = ''; // Clear previous entries

            const allActivities = window.currentActivities || [];

            if (allActivities.length === 0) {
                latestActivitiesListDiv.innerHTML = '<p>æš‚æ— æ´»åŠ¨æ•°æ®ã€‚</p>';
                return;
            }

            // Filter for published activities (assuming IsPublished is a boolean/bit field)
            const publishedActivities = allActivities.filter(activity => activity.IsPublished);

            if (publishedActivities.length === 0) {
                 latestActivitiesListDiv.innerHTML = '<p>æš‚æ— å·²å‘å¸ƒçš„æ´»åŠ¨ã€‚</p>';
                 return;
            }

            // Sort activities by creation time in descending order (newest first)
            // Assuming CreateTime is available and is a valid date string/object
            const sortedActivities = [...publishedActivities].sort((a, b) => {
                 const timeA = a.CreateTime ? new Date(a.CreateTime).getTime() : 0;
                 const timeB = b.CreateTime ? new Date(b.CreateTime).getTime() : 0;
                 return timeB - timeA; // Sort descending
            });

            // Display top N latest activities (e.g., top 3 or 5)
            const topN = 3; // Display top 3 latest activities
            const latestActivities = sortedActivities.slice(0, topN);

            const list = document.createElement('ul');
            list.style.listStyle = 'none';
            list.style.padding = '0';

            latestActivities.forEach(activity => {
                const listItem = document.createElement('li');
                listItem.style.marginBottom = '10px';
                listItem.innerHTML = `<strong>${activity.Title || 'æœªçŸ¥æ´»åŠ¨'}</strong><br><small>${activity.StartTime ? new Date(activity.StartTime).toLocaleString() : 'æ—¶é—´å¾…å®š'}</small>`;
                list.appendChild(listItem);
            });

            latestActivitiesListDiv.appendChild(list);
        }

    </script>

    <!-- æ–°å¢ï¼šæ¨¡æ‹Ÿç”¨æˆ·è§’è‰²æ§åˆ¶å’Œå¯¼èˆªæ˜¾ç¤º -->
    <script>
        // Global variable to store current user role
        window.currentUserRole = null; // 'Normal' or 'Admin'

        // Function to set mock user role, hide selection, show main content, and update UI
        function selectRole(role) {
            window.currentUserRole = role;
            document.getElementById('roleSelectionArea').style.display = 'none'; // Hide role selection
            document.getElementById('mainContentArea').style.display = 'block'; // Show main content
            document.getElementById('currentRoleDisplay').textContent = `å½“å‰è§’è‰²: ${role === 'Normal' ? 'æ™®é€šç”¨æˆ·' : 'ç®¡ç†å‘˜'}`;
            console.log('ç”¨æˆ·è§’è‰²è®¾ç½®ä¸º:', role);
            updateNavigationVisibility(); // Update navigation based on selected role
            // Optionally, navigate to the default section after role selection (e.g., overview)
             showSection('overview');
        }

        // Function to update navigation menu visibility based on role
        function updateNavigationVisibility() {
            const navBtns = document.querySelectorAll('.main-nav .nav-btn');
            const normalUserSections = ['overview', 'artifact-info', 'multimedia-interaction', 'community', 'ai-qa']; // æ™®é€šç”¨æˆ·å¯è§çš„ section
            const adminSections = ['overview', 'artifact-management', 'device-management', 'activity-management', 'exhibition-hall-management', 'user-management', 'data-dashboard']; // ç®¡ç†å‘˜å¯è§çš„ section

            navBtns.forEach(btn => {
                const sectionId = btn.getAttribute('data-target');
                let isVisible = false;

                if (window.currentUserRole === 'Normal') {
                    if (normalUserSections.includes(sectionId)) {
                        isVisible = true;
                    }
                } else if (window.currentUserRole === 'Admin') {
                     if (adminSections.includes(sectionId)) {
                         isVisible = true;
                     }
                } else {
                     // å¦‚æœæ²¡æœ‰è®¾ç½®è§’è‰²ï¼ˆä¸åº”è¯¥å‘ç”Ÿï¼Œå› ä¸ºæœ‰é€‰æ‹©ç•Œé¢ï¼‰ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºä»»ä½•ç®¡ç†ç«¯å†…å®¹
                     isVisible = false;
                }

                btn.style.display = isVisible ? '' : 'none';
            });
             // ç¡®ä¿å½“å‰æ˜¾ç¤ºçš„ section åœ¨åˆ‡æ¢è§’è‰²åä»ç„¶å¯è§ï¼Œå¦‚æœä¸å¯è§åˆ™åˆ‡æ¢åˆ°é¦–é¡µæ¦‚è§ˆ
             const activeBtn = document.querySelector('.main-nav .nav-btn.active');
             if (activeBtn && activeBtn.style.display === 'none'){
                  showSection('overview');
             }
        }

        // Modify the existing DOMContentLoaded listener
        document.addEventListener('DOMContentLoaded', () => {
             // Attach event listeners to navigation buttons to call showSection
             document.querySelectorAll('.main-nav .nav-btn').forEach(button => {
                 button.addEventListener('click', () => {
                     const onclickAttr = button.getAttribute('data-target');
                     if (onclickAttr) {
                         showSection(onclickAttr);
                     } else {
                         console.error('Could not extract sectionId from data-target attribute:', onclickAttr);
                         showSection('overview');
                     }
                 });
             });

             // Initial state: main content is hidden, role selection is visible
             // We don't call showSection or updateNavigationVisibility here initially.
             // These will be called after the user selects a role via selectRole().

             // Add event listener for the search input in the artifacts section
             const searchInput = document.getElementById('searchInput');
             if (searchInput) {
                 searchInput.addEventListener('input', searchArtifacts);
             }

             // Add event listener to the form's reset event to also reset editing state
             if (artifactForm) {
                  artifactForm.addEventListener('reset', resetArtifactForm);
             }

             // Add event listener to the activity form's reset event to also reset editing state
             if (activityForm) {
                  activityForm.addEventListener('reset', resetActivityForm);
             }

             // Note: Initial showSection and updateNavigationVisibility are now called from selectRole()
        });

    </script>

    <!-- æ–°å¢ï¼šé‡æ–°é€‰æ‹©èº«ä»½åŠŸèƒ½ -->
    <script>
        function resetRoleSelection() {
            window.currentUserRole = null; // Reset the stored role
            document.getElementById('mainContentArea').style.display = 'none'; // Hide main content
            document.getElementById('roleSelectionArea').style.display = 'block'; // Show role selection
            // Optionally reset the current role display text
            document.getElementById('currentRoleDisplay').textContent = 'å½“å‰è§’è‰²: æœªè®¾ç½®';
            console.log('é‡ç½®èº«ä»½é€‰æ‹©');
        }
    </script>

    <!-- Include qrcode.js library from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- JavaScript to generate QR code -->
    <script>
        // Change the event listener from DOMContentLoaded to window.onload to ensure the QRCode library is fully loaded.
        window.onload = function() {
            // Find the QR code container
            const qrcodeDiv = document.getElementById('qrcode');

            if (qrcodeDiv) {
                // Get the current page URL
                const currentPageUrl = window.location.href;

                // Generate QR code
                new QRCode(qrcodeDiv, {
                    text: currentPageUrl,
                    width: 128,
                    height: 128,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H
                });
                console.log("QR code generated for URL:", currentPageUrl);
            } else {
                 console.error("QR code div not found.");
            }
        };
    </script>

</body>

</html> 